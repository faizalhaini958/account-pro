import{r as q,u as k,j as e,H}from"./app-De9YtYVO.js";import{D as L}from"./DashboardLayout-DB0kk3mn.js";import{D as B}from"./data-table-D4pKVaNe.js";import{columns as R}from"./columns-o2T35CUf.js";import{B as o,a as $}from"./index-sqIKGjOx.js";import{D as z,a as E,b as M,c as O,d as V,e as A,f as Q}from"./dialog-B_EPHwqc.js";import{I as p}from"./input-YJ4y34zb.js";import{L as u}from"./label-BNYjQoyA.js";import{T as G}from"./textarea-BrFMof27.js";import{S as J,a as K,b as U,c as W,d as X}from"./select-B2rqhBdx.js";import{P as Y,a as Z,b as ee,C as se}from"./calendar-DDO4Otf0.js";import{T as te,a as ae,b as v,c as d,d as re,e as m}from"./table-3xAxy9mO.js";import{f as g}from"./format-D9s8ZFBe.js";import{u as ie}from"./useTranslation-CmIvGiqX.js";import{P as y}from"./plus-DIUrj948.js";import{C as ce}from"./calendar-DaZVa6bq.js";import{T as ne}from"./trash-2-Dreerc3R.js";import{L as le}from"./loader-circle-DjIWaf7f.js";import{f as oe}from"./format-BS8Ay9AX.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./dropdown-menu-BBgrL1DT.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./checkbox-DSt0QHsS.js";import"./index-CENxNQLL.js";import"./badge-C9h6T3rK.js";import"./arrow-up-down-1q5LzOz0.js";import"./ellipsis-yQlqSxW1.js";import"./chevron-left-BEvpDX_2.js";function Ue({invoices:b,suppliers:N,products:de}){const{t}=ie(),[_,x]=q.useState(!1),{data:r,setData:n,post:I,processing:j,errors:c,reset:C}=k({supplier_id:"",reference_number:"",date:new Date,due_date:new Date,notes:"",items:[{product_id:"",description:"",quantity:1,unit_price:0,tax_percent:0,track_inventory:!1}]}),w=()=>{n("items",[...r.items,{product_id:"",description:"",quantity:1,unit_price:0,tax_percent:0,track_inventory:!1}])},T=s=>{if(r.items.length<=1)return;const a=r.items.filter((i,l)=>l!==s);n("items",a)},h=(s,a,i)=>{const l=[...r.items];l[s]={...l[s],[a]:i},n("items",l)},D=()=>r.items.reduce((s,a)=>{const i=a.quantity||0,l=a.unit_price||0,F=a.tax_percent||0,f=i*l,P=f*(F/100);return s+f+P},0),S=s=>{s.preventDefault(),I(route("purchase.invoices.store"),{onSuccess:()=>{x(!1),C()}})};return e.jsxs(L,{header:t("purchaseInvoices.title"),children:[e.jsx(H,{title:t("purchaseInvoices.title")}),e.jsxs("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:t("purchaseInvoices.title")}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(z,{open:_,onOpenChange:x,children:[e.jsx(E,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),t("purchaseInvoices.new")]})}),e.jsxs(M,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(O,{children:[e.jsx(V,{children:t("purchaseInvoices.create")}),e.jsx(A,{children:t("purchaseInvoices.createDesc")})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-1 lg:col-span-2 space-y-2",children:[e.jsx(u,{htmlFor:"supplier_id",children:t("purchaseInvoices.supplier")}),e.jsxs(J,{value:r.supplier_id,onValueChange:s=>n("supplier_id",s),children:[e.jsx(K,{children:e.jsx(U,{placeholder:t("purchaseInvoices.selectSupplier")})}),e.jsx(W,{children:N?.map(s=>e.jsx(X,{value:s.id.toString(),children:s.name},s.id))})]}),c.supplier_id&&e.jsx("p",{className:"text-sm text-red-500",children:c.supplier_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"reference_number",children:t("purchaseInvoices.reference")}),e.jsx(p,{id:"reference_number",value:r.reference_number,onChange:s=>n("reference_number",s.target.value),placeholder:t("purchaseInvoices.referencePlaceholder")}),c.reference_number&&e.jsx("p",{className:"text-sm text-red-500",children:c.reference_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:t("purchaseInvoices.date")}),e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:$("w-full pl-3 text-left font-normal",!r.date&&"text-muted-foreground"),children:[r.date?oe(r.date,"dd/MM/yyyy"):e.jsx("span",{children:t("common.date")}),e.jsx(ce,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(ee,{className:"w-auto p-0",align:"start",children:e.jsx(se,{mode:"single",selected:r.date,onSelect:s=>s&&n("date",s),initialFocus:!0})})]}),c.date&&e.jsx("p",{className:"text-sm text-red-500",children:c.date})]})]}),e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(v,{children:[e.jsx(d,{className:"w-[30%]",children:t("products.description")}),e.jsx(d,{className:"w-[15%]",children:"Qty"}),e.jsx(d,{className:"w-[20%]",children:t("products.retailPrice")}),e.jsx(d,{className:"w-[15%]",children:t("creditNotes.tax")}),e.jsx(d,{className:"text-right",children:t("purchaseInvoices.grandTotal").replace(":","")}),e.jsx(d,{className:"w-[5%]"})]})}),e.jsx(re,{children:r.items.map((s,a)=>e.jsxs(v,{children:[e.jsxs(m,{children:[e.jsx(p,{value:s.description,onChange:i=>h(a,"description",i.target.value),placeholder:t("products.descriptionPlaceholder")}),c[`items.${a}.description`]&&e.jsx("p",{className:"text-sm text-red-500",children:c[`items.${a}.description`]})]}),e.jsx(m,{children:e.jsx(p,{type:"number",min:"0",step:"1",value:s.quantity,onChange:i=>h(a,"quantity",parseFloat(i.target.value)||0)})}),e.jsx(m,{children:e.jsx(p,{type:"number",min:"0",step:"0.01",value:s.unit_price,onChange:i=>h(a,"unit_price",parseFloat(i.target.value)||0)})}),e.jsx(m,{children:e.jsx(p,{type:"number",min:"0",step:"1",value:s.tax_percent,onChange:i=>h(a,"tax_percent",parseFloat(i.target.value)||0)})}),e.jsx(m,{className:"text-right font-medium",children:g(s.quantity*s.unit_price*(1+s.tax_percent/100))}),e.jsx(m,{children:e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>T(a),children:e.jsx(ne,{className:"h-4 w-4 text-red-500"})})})]},a))})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:w,children:[e.jsx(y,{className:"mr-2 h-4 w-4"})," ",t("common.create")]}),e.jsxs("div",{className:"text-lg font-bold",children:[t("purchaseInvoices.grandTotal")," ",g(D())]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"notes",children:t("purchaseInvoices.notes")}),e.jsx(G,{id:"notes",value:r.notes,onChange:s=>n("notes",s.target.value),placeholder:t("purchaseInvoices.notes")})]}),e.jsxs(Q,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>x(!1),children:t("common.cancel")}),e.jsxs(o,{type:"submit",disabled:j,children:[j&&e.jsx(le,{className:"mr-2 h-4 w-4 animate-spin"}),t("purchaseInvoices.create")]})]})]})]})]})})]}),e.jsx("div",{className:"hidden h-full flex-1 flex-col space-y-8 md:flex",children:e.jsx(B,{columns:R,data:b.data})})]})]})}export{Ue as default};
