const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/app-De9YtYVO.js","assets/app-DHuCQXno.css"])))=>i.map(i=>d[i]);
import{u as te,j as e,H as ae,L as re,_ as N}from"./app-De9YtYVO.js";import{u as ie,a as ne,e as le,o as y,s as o,f as oe,n as j,d as w}from"./schemas-9rN0axaX.js";import{D as ce}from"./DashboardLayout-DB0kk3mn.js";import{B as l,a as C}from"./index-sqIKGjOx.js";import{F as de,a as c,b as d,c as m,d as u,e as x}from"./form-CEzIzXmo.js";import{T as me,a as ue,b as P,c as p,d as xe,e as h}from"./table-3xAxy9mO.js";import{I as b}from"./input-YJ4y34zb.js";import{S,a as T,b as F,c as D,d as $}from"./select-B2rqhBdx.js";import{P as V,a as I,b as k,C as A}from"./calendar-DDO4Otf0.js";import{T as E}from"./textarea-BrFMof27.js";import{C as L,c as R}from"./card-B1noy23o.js";import{u as pe}from"./useTranslation-CmIvGiqX.js";import{C as H}from"./calendar-DaZVa6bq.js";import{T as he}from"./trash-2-Dreerc3R.js";import{C as je}from"./circle-plus-V1kVC-gi.js";import{f as B}from"./format-BS8Ay9AX.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./dropdown-menu-BBgrL1DT.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./dialog-B_EPHwqc.js";import"./label-BNYjQoyA.js";import"./plus-DIUrj948.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./index-CENxNQLL.js";import"./chevron-left-BEvpDX_2.js";const ve=y({customer_id:o().min(1,"Please select a customer."),date:w(),valid_until:w().optional(),items:oe(y({product_id:o().optional(),description:o().min(1,"Description is required"),quantity:j().min(1,"Quantity must be at least 1"),unit_price:j().min(0,"Price must be positive"),discount_amount:j().default(0),tax_rate:j().default(0)})).min(1,"At least one item is required"),notes:o().optional(),terms:o().optional()});function es({quotation:a,customers:M,products:g}){const{t:n}=pe(),{setData:_e,post:fe,processing:z}=te({customer_id:a.customer_id.toString(),date:new Date(a.date),valid_until:a.valid_until?new Date(a.valid_until):void 0,items:a.items.map(s=>({...s,product_id:s.product_id?.toString()||""})),notes:a.notes||"",terms:a.terms||""}),i=ie({resolver:ne(ve),defaultValues:{customer_id:a.customer_id.toString(),date:new Date(a.date),valid_until:a.valid_until?new Date(a.valid_until):void 0,items:a.items.map(s=>({product_id:s.product_id?.toString()||"",description:s.description,quantity:Number(s.quantity),unit_price:Number(s.unit_price),discount_amount:Number(s.discount_amount),tax_rate:Number(s.tax_rate)})),notes:a.notes||"",terms:a.terms||""}}),{fields:O,append:Q,remove:Y}=le({name:"items",control:i.control});function G(s,t){const r=g.find(f=>f.id.toString()===t);r&&(i.setValue(`items.${s}.description`,r.name),i.setValue(`items.${s}.unit_price`,parseFloat(r.retail_price)),i.setValue(`items.${s}.product_id`,t))}const v=i.watch("items"),U=()=>{let s=0,t=0;return v?.forEach(r=>{const f=r.quantity||0,q=r.unit_price||0,ee=r.discount_amount||0,se=f*q-ee;s+=se}),{subtotal:s,taxTotal:t,total:s+t}},{subtotal:J,total:K}=U();function W(s){N(async()=>{const{router:t}=await import("./app-De9YtYVO.js").then(r=>r.l);return{router:t}},__vite__mapDeps([0,1])).then(({router:t})=>{t.put(route("sales.quotations.update",a.id),{...s,valid_until:s.valid_until})})}const _=a.status==="draft",X=a.status==="accepted";function Z(){confirm("Generate Invoice from this quotation?")&&N(async()=>{const{router:s}=await import("./app-De9YtYVO.js").then(t=>t.l);return{router:s}},__vite__mapDeps([0,1])).then(({router:s})=>{s.post(route("sales.quotations.convert",a.id))})}return e.jsxs(ce,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[n("quotations.edit"),": ",a.number]}),X&&e.jsx(l,{onClick:Z,className:"bg-purple-600 hover:bg-purple-700",children:"Convert to Invoice"})]}),children:[e.jsx(ae,{title:`${n("quotations.edit")}: ${a.number}`}),e.jsxs("div",{className:"max-w-5xl mx-auto py-6",children:[!_&&e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md text-yellow-800",children:["This quotation is ",e.jsx("strong",{children:a.status}),". It cannot be edited."]}),e.jsx(de,{...i,children:e.jsx("fieldset",{disabled:!_,className:"space-y-8",children:e.jsxs("form",{onSubmit:i.handleSubmit(W),className:"space-y-8",children:[e.jsx(L,{children:e.jsxs(R,{className:"pt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{control:i.control,name:"customer_id",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:n("sales.customer")}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(u,{children:e.jsx(T,{children:e.jsx(F,{placeholder:n("user.selectCompany")})})}),e.jsx(D,{children:M.map(t=>e.jsxs($,{value:t.id.toString(),children:[t.name," ",t.company_name?`(${t.company_name})`:""]},t.id))})]}),e.jsx(x,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:i.control,name:"date",render:({field:s})=>e.jsxs(d,{className:"flex flex-col",children:[e.jsx(m,{children:n("sales.date")}),e.jsxs(V,{children:[e.jsx(I,{asChild:!0,children:e.jsx(u,{children:e.jsxs(l,{variant:"outline",className:C("pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?B(s.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(H,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(k,{className:"w-auto p-0",align:"start",children:e.jsx(A,{mode:"single",selected:s.value,onSelect:s.onChange,disabled:t=>t>new Date||t<new Date("1900-01-01"),initialFocus:!0})})]}),e.jsx(x,{})]})}),e.jsx(c,{control:i.control,name:"valid_until",render:({field:s})=>e.jsxs(d,{className:"flex flex-col",children:[e.jsx(m,{children:n("quotations.validUntil")}),e.jsxs(V,{children:[e.jsx(I,{asChild:!0,children:e.jsx(u,{children:e.jsxs(l,{variant:"outline",className:C("pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?B(s.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(H,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(k,{className:"w-auto p-0",align:"start",children:e.jsx(A,{mode:"single",selected:s.value||void 0,onSelect:s.onChange,initialFocus:!0})})]}),e.jsx(x,{})]})})]})]})}),e.jsxs("div",{className:"rounded-md border bg-card",children:[e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(P,{children:[e.jsx(p,{className:"w-[300px]",children:n("products.name")}),e.jsx(p,{className:"w-[100px]",children:"Quantity"}),e.jsx(p,{className:"w-[150px]",children:n("products.retailPrice")}),e.jsx(p,{className:"w-[150px] text-right",children:n("sales.amount")}),e.jsx(p,{className:"w-[50px]"})]})}),e.jsx(xe,{children:O.map((s,t)=>e.jsxs(P,{children:[e.jsx(h,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{onValueChange:r=>G(t,r),defaultValue:i.getValues(`items.${t}.product_id`)||void 0,children:[e.jsx(T,{children:e.jsx(F,{placeholder:n("common.search")})}),e.jsx(D,{children:g.map(r=>e.jsxs($,{value:r.id.toString(),children:[r.sku?`[${r.sku}] `:"",r.name]},r.id))})]}),e.jsx(b,{...i.register(`items.${t}.description`),placeholder:"Description"})]})}),e.jsx(h,{children:e.jsx(b,{type:"number",min:"1",...i.register(`items.${t}.quantity`,{valueAsNumber:!0})})}),e.jsx(h,{children:e.jsx(b,{type:"number",step:"0.01",...i.register(`items.${t}.unit_price`,{valueAsNumber:!0})})}),e.jsx(h,{className:"text-right",children:((v[t]?.quantity||0)*(v[t]?.unit_price||0)).toFixed(2)}),e.jsx(h,{children:e.jsx(l,{type:"button",variant:"ghost",size:"sm",onClick:()=>Y(t),children:e.jsx(he,{className:"h-4 w-4 text-destructive"})})})]},s.id))})]}),e.jsx("div",{className:"p-4",children:e.jsxs(l,{type:"button",variant:"outline",size:"sm",onClick:()=>Q({product_id:"",description:"",quantity:1,unit_price:0,discount_amount:0,tax_rate:0}),children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Add Item"]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"w-1/3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{children:["MYR ",J.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:n("sales.amount")}),e.jsxs("span",{children:["MYR ",K.toFixed(2)]})]})]})}),e.jsx(L,{children:e.jsxs(R,{className:"pt-6 grid gap-6",children:[e.jsx(c,{control:i.control,name:"notes",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Notes"}),e.jsx(u,{children:e.jsx(E,{...s,placeholder:"Notes"})}),e.jsx(x,{})]})}),e.jsx(c,{control:i.control,name:"terms",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Terms & Conditions"}),e.jsx(u,{children:e.jsx(E,{...s,placeholder:"Payment terms, delivery info..."})}),e.jsx(x,{})]})})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(l,{variant:"outline",asChild:!0,children:e.jsx(re,{href:route("sales.quotations.index"),children:n("common.back")})}),_&&e.jsx(l,{type:"submit",disabled:z,children:n("common.saveChanges")})]})]})})})]})]})}export{es as default};
