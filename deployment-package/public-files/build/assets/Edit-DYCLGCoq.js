const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/app-De9YtYVO.js","assets/app-DHuCQXno.css"])))=>i.map(i=>d[i]);
import{j as e,H as T,L as S,_ as G}from"./app-De9YtYVO.js";import{D as F}from"./DashboardLayout-DB0kk3mn.js";import{B as u,a as q}from"./index-sqIKGjOx.js";import{C as b,a as g,b as C,c as N}from"./card-B1noy23o.js";import{I as f}from"./input-YJ4y34zb.js";import{T as J}from"./textarea-BrFMof27.js";import{F as K,a as i,b as o,c as _,d,e as m}from"./form-CEzIzXmo.js";import{S as W,a as X,b as Y,c as Z,d as ee}from"./select-B2rqhBdx.js";import{P as $,a as P,b as k,C as D}from"./calendar-DDO4Otf0.js";import{u as se,a as re,e as te,o as E,f as ae,s as h,d as L,b as ne,n as I}from"./schemas-9rN0axaX.js";import{T as le,a as ce,b as H,c as p,d as ie,e as x}from"./table-3xAxy9mO.js";import{f as M}from"./format-D9s8ZFBe.js";import{u as oe}from"./useTranslation-CmIvGiqX.js";import{C as V}from"./calendar-DaZVa6bq.js";import{P as de}from"./plus-DIUrj948.js";import{T as ue}from"./trash-2-Dreerc3R.js";import{f as B}from"./format-BS8Ay9AX.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./dropdown-menu-BBgrL1DT.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./dialog-B_EPHwqc.js";import"./label-BNYjQoyA.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./index-CENxNQLL.js";import"./chevron-left-BEvpDX_2.js";const me=E({product_id:h().optional().nullable(),description:h().min(1,"Description is required"),quantity:I().min(.01),unit_price:I().min(0),tax_percent:I().min(0).optional().nullable(),track_inventory:ne().default(!1)}),pe=E({supplier_id:h().min(1,"Supplier is required"),date:L(),due_date:L(),reference_number:h().min(1,"Reference number is required"),notes:h().optional().nullable(),terms:h().optional().nullable(),items:ae(me).min(1,"At least one item is required")});function Ke({invoice:n,suppliers:R,products:xe}){const{t:r}=oe(),l=se({resolver:re(pe),defaultValues:{supplier_id:n.supplier_id.toString(),date:new Date(n.date),due_date:new Date(n.due_date),reference_number:n.reference_number,notes:n.notes||"",terms:n.terms||"",items:n.items.map(s=>({product_id:s.product_id?s.product_id.toString():null,description:s.description,quantity:parseFloat(s.quantity),unit_price:parseFloat(s.unit_price),tax_percent:parseFloat(s.tax_percent),track_inventory:!!s.track_inventory}))}}),{fields:A,append:z,remove:O}=te({control:l.control,name:"items"}),w=l.watch("items"),Q=()=>w.reduce((s,a)=>{const t=a.quantity||0,c=a.unit_price||0,j=a.tax_percent||0,v=t*c,y=v*(j/100);return s+v+y},0),U=s=>{G(async()=>{const{router:a}=await import("./app-De9YtYVO.js").then(t=>t.l);return{router:a}},__vite__mapDeps([0,1])).then(({router:a})=>{a.put(route("purchase.invoices.update",n.id),{...s,supplier_id:parseInt(s.supplier_id),items:s.items.map(t=>({...t,product_id:t.product_id?parseInt(t.product_id):null}))})})};return n.status!=="draft"?e.jsxs(F,{header:`${r("purchaseInvoices.view")}: ${n.reference_number}`,children:[e.jsx(T,{title:`${r("purchaseInvoices.view")} ${n.reference_number}`}),e.jsx("div",{className:"max-w-7xl mx-auto py-6",children:e.jsxs(b,{children:[e.jsx(g,{children:e.jsxs(C,{children:[r("purchaseInvoices.status"),": ",n.status.toUpperCase()]})}),e.jsxs(N,{children:[e.jsx("p",{children:r("purchaseInvoices.readOnly",{status:n.status})}),e.jsx("div",{className:"mt-4",children:e.jsx(u,{variant:"outline",asChild:!0,children:e.jsx(S,{href:route("purchase.invoices.index"),children:r("purchaseInvoices.backToList")})})})]})]})})]}):e.jsxs(F,{header:`${r("purchaseInvoices.edit")}: ${n.reference_number}`,children:[e.jsx(T,{title:`${r("purchaseInvoices.edit")} ${n.reference_number}`}),e.jsx("div",{className:"max-w-7xl mx-auto py-6",children:e.jsx(K,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(U),className:"space-y-8",children:[e.jsxs(b,{children:[e.jsx(g,{children:e.jsx(C,{children:r("purchaseInvoices.details")})}),e.jsxs(N,{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{control:l.control,name:"supplier_id",render:({field:s})=>e.jsxs(o,{className:"col-span-2",children:[e.jsx(_,{children:r("purchaseInvoices.supplier")}),e.jsxs(W,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(d,{children:e.jsx(X,{children:e.jsx(Y,{placeholder:r("purchaseInvoices.selectSupplier")})})}),e.jsx(Z,{children:R.map(a=>e.jsx(ee,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(m,{})]})}),e.jsx(i,{control:l.control,name:"reference_number",render:({field:s})=>e.jsxs(o,{children:[e.jsx(_,{children:r("purchaseInvoices.reference")}),e.jsx(d,{children:e.jsx(f,{...s,placeholder:r("purchaseInvoices.referencePlaceholder")})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{children:r("purchaseInvoices.dates")}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{control:l.control,name:"date",render:({field:s})=>e.jsxs(o,{className:"flex-1",children:[e.jsxs($,{children:[e.jsx(P,{asChild:!0,children:e.jsx(d,{children:e.jsxs(u,{variant:"outline",className:q("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?B(s.value,"dd/MM/yyyy"):e.jsx("span",{children:"Pick a date"}),e.jsx(V,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(k,{className:"w-auto p-0",align:"start",children:e.jsx(D,{mode:"single",selected:s.value,onSelect:s.onChange,initialFocus:!0})})]}),e.jsx(m,{})]})}),e.jsx(i,{control:l.control,name:"due_date",render:({field:s})=>e.jsxs(o,{className:"flex-1",children:[e.jsxs($,{children:[e.jsx(P,{asChild:!0,children:e.jsx(d,{children:e.jsxs(u,{variant:"outline",className:q("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?B(s.value,"dd/MM/yyyy"):e.jsx("span",{children:r("purchaseInvoices.dueDate")}),e.jsx(V,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(k,{className:"w-auto p-0",align:"start",children:e.jsx(D,{mode:"single",selected:s.value,onSelect:s.onChange,initialFocus:!0})})]}),e.jsx(m,{})]})})]})]})]})]}),e.jsxs(b,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between",children:[e.jsx(C,{children:r("purchaseInvoices.items")}),e.jsxs(u,{type:"button",size:"sm",onClick:()=>z({description:"",quantity:1,unit_price:0,tax_percent:0,track_inventory:!1}),children:[e.jsx(de,{className:"h-4 w-4 mr-2"})," ",r("common.create")]})]}),e.jsxs(N,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:e.jsxs(H,{children:[e.jsx(p,{className:"w-[300px]",children:r("products.description")}),e.jsx(p,{className:"w-[100px]",children:"Qty"}),e.jsx(p,{className:"w-[150px]",children:r("products.retailPrice")}),e.jsx(p,{className:"w-[100px]",children:r("creditNotes.tax")}),e.jsx(p,{className:"text-right",children:r("purchaseInvoices.grandTotal").replace(":","")}),e.jsx(p,{className:"w-[50px]"})]})}),e.jsx(ie,{children:A.map((s,a)=>e.jsxs(H,{children:[e.jsx(x,{children:e.jsx(i,{control:l.control,name:`items.${a}.description`,render:({field:t})=>e.jsxs(o,{children:[e.jsx(d,{children:e.jsx(f,{...t,placeholder:"Item description"})}),e.jsx(m,{})]})})}),e.jsx(x,{children:e.jsx(i,{control:l.control,name:`items.${a}.quantity`,render:({field:t})=>e.jsx(o,{children:e.jsx(d,{children:e.jsx(f,{type:"number",step:"1",...t,onChange:c=>t.onChange(parseFloat(c.target.value))})})})})}),e.jsx(x,{children:e.jsx(i,{control:l.control,name:`items.${a}.unit_price`,render:({field:t})=>e.jsx(o,{children:e.jsx(d,{children:e.jsx(f,{type:"number",step:"0.01",...t,onChange:c=>t.onChange(parseFloat(c.target.value))})})})})}),e.jsx(x,{children:e.jsx(i,{control:l.control,name:`items.${a}.tax_percent`,render:({field:t})=>e.jsx(o,{children:e.jsx(d,{children:e.jsx(f,{type:"number",step:"1",...t,value:t.value??"",onChange:c=>{const j=c.target.value===""?null:parseFloat(c.target.value);t.onChange(j)}})})})})}),e.jsx(x,{className:"text-right",children:(()=>{const t=w[a];if(!t)return"0.00";const c=t.quantity||0,j=t.unit_price||0,v=t.tax_percent||0,y=c*j*(1+v/100);return M(y)})()}),e.jsx(x,{children:e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>O(a),children:e.jsx(ue,{className:"h-4 w-4 text-red-500"})})})]},s.id))})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("div",{className:"w-1/3 space-y-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:r("purchaseInvoices.grandTotal")}),e.jsx("span",{children:M(Q())})]})})})]})]}),e.jsx(i,{control:l.control,name:"notes",render:({field:s})=>e.jsxs(o,{children:[e.jsx(_,{children:r("purchaseInvoices.notes")}),e.jsx(d,{children:e.jsx(J,{...s,value:s.value||""})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(u,{variant:"outline",asChild:!0,children:e.jsx(S,{href:route("purchase.invoices.index"),children:r("common.cancel")})}),e.jsx(u,{type:"submit",disabled:l.formState.isSubmitting,children:r("purchaseInvoices.update")})]})]})})})]})}export{Ke as default};
