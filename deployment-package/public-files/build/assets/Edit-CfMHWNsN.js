const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/app-De9YtYVO.js","assets/app-DHuCQXno.css"])))=>i.map(i=>d[i]);
import{j as e,H as z,L as H,_ as O}from"./app-De9YtYVO.js";import{D as Q}from"./DashboardLayout-DB0kk3mn.js";import{B as x}from"./index-sqIKGjOx.js";import{C,c as S}from"./card-B1noy23o.js";import{I as u}from"./input-YJ4y34zb.js";import{L as p}from"./label-BNYjQoyA.js";import{S as w,a as F,b as q,c as I,d as P}from"./select-B2rqhBdx.js";import{T as M}from"./textarea-BrFMof27.js";import{F as G,a as o,b as l,c as j,d as c,e as h}from"./form-CEzIzXmo.js";import{u as J,a as K,e as U,o as T,f as W,s as d,n as b}from"./schemas-9rN0axaX.js";import{f as _}from"./format-D9s8ZFBe.js";import{u as X}from"./useTranslation-CmIvGiqX.js";import{P as Y}from"./plus-DIUrj948.js";import{T as Z}from"./trash-2-Dreerc3R.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./dropdown-menu-BBgrL1DT.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./dialog-B_EPHwqc.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./index-CENxNQLL.js";const ee=T({customer_id:d().min(1,"Customer is required"),date:d().min(1,"Date is required"),invoice_id:d().optional().nullable(),reason:d().optional().nullable(),notes:d().optional().nullable(),items:W(T({product_id:d().min(1,"Product is required"),description:d().min(1,"Description is required"),quantity:b().min(.01,"Quantity must be greater than 0"),unit_price:b().min(0,"Price must be positive"),discount_amount:b().optional().nullable(),tax_percent:b().optional().nullable()})).min(1,"At least one item is required")});function Ve({creditNote:i,customers:V,products:g}){const{t:$}=X(),m=i.status==="draft",n=J({resolver:K(ee),defaultValues:{customer_id:i.customer_id.toString(),date:i.date,invoice_id:i.invoice_id?.toString()||"",reason:i.reason,notes:i.notes,items:i.items.map(s=>({product_id:s.product_id?.toString()||"",description:s.description,quantity:Number(s.quantity),unit_price:Number(s.unit_price),discount_amount:Number(s.discount_amount),tax_percent:Number(s.tax_percent)}))}}),{fields:D,append:L,remove:E}=U({control:n.control,name:"items"}),f=n.watch("items").reduce((s,t)=>{const r=Number(t.quantity)||0,a=Number(t.unit_price)||0,v=Number(t.discount_amount)||0,A=Number(t.tax_percent)||0,y=r*a-v,N=y*(A/100),B=y+N;return{subtotal:s.subtotal+r*a,discount:s.discount+v,tax:s.tax+N,total:s.total+B}},{subtotal:0,discount:0,tax:0,total:0}),R=s=>{O(async()=>{const{router:t}=await import("./app-De9YtYVO.js").then(r=>r.l);return{router:t}},__vite__mapDeps([0,1])).then(({router:t})=>{t.put(route("sales.credit-notes.update",i.id),s)})},k=(s,t)=>{const r=g.find(a=>a.id.toString()===t);r&&(n.setValue(`items.${s}.product_id`,t),n.setValue(`items.${s}.description`,r.name),n.setValue(`items.${s}.unit_price`,parseFloat(r.retail_price)))};return e.jsxs(Q,{header:`Edit Credit Note: ${i.number}`,children:[e.jsx(z,{title:`Edit Credit Note: ${i.number}`}),e.jsxs("div",{className:"max-w-5xl mx-auto py-6",children:[!m&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md text-yellow-800",children:$("creditNotes.readOnly",{status:i.status})}),e.jsx(G,{...n,children:e.jsx("fieldset",{disabled:!m,className:"space-y-8",children:e.jsxs("form",{onSubmit:n.handleSubmit(R),className:"space-y-8",children:[e.jsx(C,{children:e.jsxs(S,{className:"pt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(o,{control:n.control,name:"customer_id",render:({field:s})=>e.jsxs(l,{children:[e.jsx(j,{children:"Customer"}),e.jsxs(w,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(c,{children:e.jsx(F,{children:e.jsx(q,{placeholder:"Select Customer"})})}),e.jsx(I,{children:V.map(t=>e.jsxs(P,{value:t.id.toString(),children:[t.name," ",t.company_name?`(${t.company_name})`:""]},t.id))})]}),e.jsx(h,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:n.control,name:"date",render:({field:s})=>e.jsxs(l,{children:[e.jsx(j,{children:"Date"}),e.jsx(c,{children:e.jsx(u,{type:"date",...s})}),e.jsx(h,{})]})}),e.jsx(o,{control:n.control,name:"invoice_id",render:({field:s})=>e.jsxs(l,{children:[e.jsx(j,{children:"Reference Invoice"}),e.jsx(c,{children:e.jsx(u,{...s,value:s.value||"",placeholder:"Invoice ID"})}),e.jsx(h,{})]})})]}),e.jsx(o,{control:n.control,name:"reason",render:({field:s})=>e.jsxs(l,{className:"col-span-1 md:col-span-2",children:[e.jsx(j,{children:"Reason"}),e.jsx(c,{children:e.jsx(M,{...s,value:s.value||"",placeholder:"Reason for credit note..."})}),e.jsx(h,{})]})})]})}),e.jsx(C,{children:e.jsxs(S,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Items"}),m&&e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:()=>L({product_id:"",description:"",quantity:1,unit_price:0,discount_amount:0,tax_percent:0}),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"})," Add Item"]})]}),D.map((s,t)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end border p-4 rounded-lg bg-gray-50/50",children:[e.jsx("div",{className:"col-span-12 md:col-span-4",children:e.jsx(o,{control:n.control,name:`items.${t}.product_id`,render:({field:r})=>e.jsxs(l,{children:[e.jsx(p,{children:"Product"}),e.jsxs(w,{onValueChange:a=>k(t,a),defaultValue:r.value,children:[e.jsx(c,{children:e.jsx(F,{children:e.jsx(q,{placeholder:"Select Product"})})}),e.jsx(I,{children:g.map(a=>e.jsxs(P,{value:a.id.toString(),children:[a.sku," - ",a.name]},a.id))})]})]})})}),e.jsx("div",{className:"col-span-12 md:col-span-4",children:e.jsx(o,{control:n.control,name:`items.${t}.description`,render:({field:r})=>e.jsxs(l,{children:[e.jsx(p,{children:"Description"}),e.jsx(c,{children:e.jsx(u,{...r})})]})})}),e.jsx("div",{className:"col-span-6 md:col-span-2",children:e.jsx(o,{control:n.control,name:`items.${t}.quantity`,render:({field:r})=>e.jsxs(l,{children:[e.jsx(p,{children:"Qty"}),e.jsx(c,{children:e.jsx(u,{type:"number",...r,onChange:a=>r.onChange(parseFloat(a.target.value))})})]})})}),e.jsx("div",{className:"col-span-6 md:col-span-2",children:e.jsx(o,{control:n.control,name:`items.${t}.unit_price`,render:({field:r})=>e.jsxs(l,{children:[e.jsx(p,{children:"Price"}),e.jsx(c,{children:e.jsx(u,{type:"number",...r,onChange:a=>r.onChange(parseFloat(a.target.value))})})]})})}),e.jsx("div",{className:"col-span-12 flex justify-end",children:m&&e.jsxs(x,{type:"button",variant:"ghost",size:"sm",className:"text-red-500",onClick:()=>E(t),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"})," Remove"]})})]},s.id)),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs("div",{className:"w-64 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal:"}),e.jsx("span",{children:_(f.subtotal)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tax:"}),e.jsx("span",{children:_(f.tax)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Amount:"}),e.jsx("span",{children:_(f.total)})]})]})})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(x,{variant:"outline",asChild:!0,children:e.jsx(H,{href:route("sales.credit-notes.index"),children:"Back"})}),m&&e.jsx(x,{type:"submit",disabled:n.formState.isSubmitting,children:"Save Changes"})]})]})})})]})]})}export{Ve as default};
