import{r as i,j as e,H as re,L as T,a as l}from"./app-De9YtYVO.js";import{A as ce}from"./AdminLayout-B9Mfz47I.js";import{C as $,c as J,a as de,b as oe}from"./card-B1noy23o.js";import{B as t}from"./index-sqIKGjOx.js";import{I as me}from"./input-YJ4y34zb.js";import{B as C}from"./badge-C9h6T3rK.js";import{T as he,a as xe,b as B,c as d,d as ue,e as r}from"./table-3xAxy9mO.js";import{D as je,a as pe,b as ge,d as ve,c as n,e as M}from"./dropdown-menu-BBgrL1DT.js";import{S as N,a as y,b as w,c as _,d as a}from"./select-B2rqhBdx.js";import{D as k,b as L,c as E,d as I,e as H,f as P}from"./dialog-B_EPHwqc.js";import{L as V}from"./label-BNYjQoyA.js";import{T as be}from"./textarea-BrFMof27.js";import{S as fe}from"./search-BkjZB7Ok.js";import{U as Se}from"./users-Cw2EaZtR.js";import{S as Ce}from"./shield-CJZNipff.js";import{E as Ne}from"./ellipsis-yQlqSxW1.js";import{E as ye}from"./eye-BecJcslc.js";import{P as we}from"./pencil-DxiAzbLY.js";import{C as W}from"./credit-card-wln7jJg5.js";import{U as _e}from"./user-cog-B_brAzyi.js";import{C as De}from"./circle-x-Tpw7YRGA.js";import{C as X}from"./circle-check-DHnGCJry.js";import{B as Ae}from"./ban-BeVP-ciD.js";import{T as Ue}from"./trash-2-Dreerc3R.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./useTranslation-CmIvGiqX.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./ThemeToggle-IPjgC8LT.js";import"./package-DX_4eLNa.js";import"./file-text-D4ZH2B6r.js";import"./index-CENxNQLL.js";function ds({users:o,plans:q,filters:D}){const[A,G]=i.useState(D.search),[m,K]=i.useState(D.status||"all"),[h,Q]=i.useState(D.subscription||"all"),[u,j]=i.useState(null),[p,R]=i.useState(""),[g,v]=i.useState(null),[b,F]=i.useState(""),[O,Z]=i.useState("monthly"),[f,S]=i.useState(null),ee=s=>{s.preventDefault(),l.get(route("admin.users.index"),{search:A,status:m==="all"?"":m,subscription:h==="all"?"":h},{preserveState:!0})},z=(s,c)=>{const x={search:A,status:m==="all"?"":m,subscription:h==="all"?"":h};x[s]=c==="all"?"":c,s==="status"&&K(c),s==="subscription"&&Q(c),l.get(route("admin.users.index"),x,{preserveState:!0})},se=()=>{u&&p&&l.post(route("admin.users.ban",u.id),{reason:p},{preserveScroll:!0,onSuccess:()=>{j(null),R("")}})},ae=s=>{l.post(route("admin.users.unban",s.id),{},{preserveScroll:!0})},Y=s=>{l.post(route("admin.users.toggle",s.id),{},{preserveScroll:!0})},ne=()=>{g&&b&&l.post(route("admin.users.subscription.assign",g.id),{plan_id:b,billing_cycle:O},{preserveScroll:!0,onSuccess:()=>{v(null),F("")}})},ie=s=>{confirm(`Are you sure you want to login as ${s.name}?`)&&l.post(route("admin.users.impersonate",s.id))},le=()=>{f&&l.delete(route("admin.users.destroy",f.id),{preserveScroll:!0,onSuccess:()=>{S(null)}})},te=s=>{const x={active:{variant:"default",label:"Active"},inactive:{variant:"secondary",label:"Inactive"},banned:{variant:"destructive",label:"Banned"},pending:{variant:"outline",label:"Pending"}}[s]||{variant:"outline",label:s};return e.jsx(C,{variant:x.variant,children:x.label})},U=s=>s?new Date(s).toLocaleDateString("en-MY",{year:"numeric",month:"short",day:"numeric"}):"-";return e.jsxs(ce,{header:"User Management",children:[e.jsx(re,{title:"User Management"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user accounts, subscriptions, and access"})]}),e.jsx($,{children:e.jsx(J,{className:"pt-6",children:e.jsxs("form",{onSubmit:ee,className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(me,{placeholder:"Search by name or email...",value:A,onChange:s=>G(s.target.value),className:"pl-10"})]})}),e.jsxs(N,{value:m,onValueChange:s=>z("status",s),children:[e.jsx(y,{className:"w-[150px]",children:e.jsx(w,{placeholder:"All Status"})}),e.jsxs(_,{children:[e.jsx(a,{value:"all",children:"All Status"}),e.jsx(a,{value:"active",children:"Active"}),e.jsx(a,{value:"inactive",children:"Inactive"}),e.jsx(a,{value:"banned",children:"Banned"}),e.jsx(a,{value:"pending",children:"Pending"})]})]}),e.jsxs(N,{value:h,onValueChange:s=>z("subscription",s),children:[e.jsx(y,{className:"w-[180px]",children:e.jsx(w,{placeholder:"All Subscriptions"})}),e.jsxs(_,{children:[e.jsx(a,{value:"all",children:"All Subscriptions"}),e.jsx(a,{value:"active",children:"Has Subscription"}),e.jsx(a,{value:"none",children:"No Subscription"})]})]}),e.jsx(t,{type:"submit",children:"Search"})]})})}),e.jsxs($,{children:[e.jsx(de,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Users (",o.total,")"]})}),e.jsxs(J,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:e.jsxs(B,{children:[e.jsx(d,{children:"User"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Subscription"}),e.jsx(d,{children:"Companies"}),e.jsx(d,{children:"Last Login"}),e.jsx(d,{children:"Joined"}),e.jsx(d,{className:"text-right",children:"Actions"})]})}),e.jsx(ue,{children:o.data.length===0?e.jsx(B,{children:e.jsx(r,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):o.data.map(s=>e.jsxs(B,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center",children:s.is_super_admin?e.jsx(Ce,{className:"h-5 w-5 text-primary"}):e.jsx("span",{className:"text-sm font-medium",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.name,s.is_super_admin&&e.jsx(C,{variant:"secondary",className:"text-xs",children:"Super Admin"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsxs(r,{children:[te(s.status),s.banned_at&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 max-w-[150px] truncate",children:s.ban_reason})]}),e.jsx(r,{children:s.subscription?e.jsxs("div",{children:[e.jsx(C,{variant:"outline",children:s.subscription.plan}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.subscription.ends_at?`Expires ${U(s.subscription.ends_at)}`:"Active"})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No subscription"})}),e.jsx(r,{children:e.jsx(C,{variant:"outline",children:s.tenants_count})}),e.jsxs(r,{children:[e.jsx("div",{className:"text-sm",children:U(s.last_login_at)}),s.last_login_ip&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.last_login_ip})]}),e.jsx(r,{children:U(s.created_at)}),e.jsx(r,{className:"text-right",children:e.jsxs(je,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(t,{variant:"ghost",size:"icon",children:e.jsx(Ne,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsx(ve,{children:"Actions"}),e.jsx(n,{asChild:!0,children:e.jsxs(T,{href:route("admin.users.show",s.id),children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"View Details"]})}),e.jsx(n,{asChild:!0,children:e.jsxs(T,{href:route("admin.users.edit",s.id),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Edit"]})}),e.jsx(M,{}),s.subscription?e.jsx(n,{asChild:!0,children:e.jsxs(T,{href:route("admin.subscriptions.index",{search:s.email}),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"View Subscription"]})}):e.jsxs(n,{onClick:()=>v(s),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Assign Subscription"]}),!s.is_super_admin&&e.jsxs(n,{onClick:()=>ie(s),children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Login as User"]}),e.jsx(M,{}),s.status==="active"&&!s.is_super_admin&&e.jsxs(n,{onClick:()=>Y(s),children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Disable"]}),s.status==="inactive"&&e.jsxs(n,{onClick:()=>Y(s),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Enable"]}),s.status==="banned"?e.jsxs(n,{onClick:()=>ae(s),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Unban"]}):!s.is_super_admin&&e.jsxs(n,{onClick:()=>j(s),className:"text-destructive",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Ban User"]}),!s.is_super_admin&&e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsxs(n,{onClick:()=>S(s),className:"text-destructive",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Delete User"]})]})]})]})})]},s.id))})]}),o.last_page>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:o.links.map((s,c)=>e.jsx(t,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,onClick:()=>s.url&&l.get(s.url),dangerouslySetInnerHTML:{__html:s.label}},c))})]})]})]}),e.jsx(k,{open:!!u,onOpenChange:()=>j(null),children:e.jsxs(L,{children:[e.jsxs(E,{children:[e.jsx(I,{children:"Ban User"}),e.jsxs(H,{children:["This will prevent ",u?.name," from accessing the system."]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"ban_reason",children:"Reason for ban"}),e.jsx(be,{id:"ban_reason",value:p,onChange:s=>R(s.target.value),placeholder:"Enter the reason for banning this user...",rows:3})]})}),e.jsxs(P,{children:[e.jsx(t,{variant:"outline",onClick:()=>j(null),children:"Cancel"}),e.jsx(t,{variant:"destructive",onClick:se,disabled:!p,children:"Ban User"})]})]})}),e.jsx(k,{open:!!g,onOpenChange:()=>v(null),children:e.jsxs(L,{children:[e.jsxs(E,{children:[e.jsx(I,{children:"Manage Subscription"}),e.jsxs(H,{children:["Assign a subscription plan to ",g?.name]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Subscription Plan"}),e.jsxs(N,{value:b,onValueChange:F,children:[e.jsx(y,{children:e.jsx(w,{placeholder:"Select a plan"})}),e.jsx(_,{children:q.map(s=>e.jsxs(a,{value:s.id.toString(),children:[s.name," - RM",s.price_monthly,"/mo"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Billing Cycle"}),e.jsxs(N,{value:O,onValueChange:Z,children:[e.jsx(y,{children:e.jsx(w,{})}),e.jsxs(_,{children:[e.jsx(a,{value:"monthly",children:"Monthly"}),e.jsx(a,{value:"yearly",children:"Yearly"})]})]})]})]}),e.jsxs(P,{children:[e.jsx(t,{variant:"outline",onClick:()=>v(null),children:"Cancel"}),e.jsx(t,{onClick:ne,disabled:!b,children:"Assign Subscription"})]})]})}),e.jsx(k,{open:!!f,onOpenChange:()=>S(null),children:e.jsxs(L,{children:[e.jsxs(E,{children:[e.jsx(I,{children:"Delete User"}),e.jsxs(H,{children:["Are you sure you want to permanently delete ",f?.name,"?"]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-lg bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Warning: This action cannot be undone."}),e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"User account will be permanently deleted"}),e.jsx("li",{children:"All associated data may be removed"}),e.jsx("li",{children:"Active subscriptions will be cancelled"})]})]})}),e.jsxs(P,{children:[e.jsx(t,{variant:"outline",onClick:()=>S(null),children:"Cancel"}),e.jsx(t,{variant:"destructive",onClick:le,children:"Delete Permanently"})]})]})})]})}export{ds as default};
