import{r as u,u as Q,j as e,H as U,L as W,a as j}from"./app-De9YtYVO.js";import{D as X}from"./DashboardLayout-DB0kk3mn.js";import{c as Z,B as d}from"./index-sqIKGjOx.js";import{C as $,a as ee,b as se,c as ae}from"./card-B1noy23o.js";import{T as te,a as ne,b as g,c as x,d as re,e as l}from"./table-3xAxy9mO.js";import{B as f}from"./badge-C9h6T3rK.js";import{C as ie,D as le,a as ce,b as oe,d as de,c as w,e as xe}from"./dropdown-menu-BBgrL1DT.js";import{D,b as A,c as S,d as T,e as L,a as me,f as he}from"./dialog-B_EPHwqc.js";import{I as O}from"./input-YJ4y34zb.js";import{L as c}from"./label-BNYjQoyA.js";import{T as ue}from"./textarea-BrFMof27.js";import{S as _,a as k,b as E,c as I,d as y,C as pe}from"./select-B2rqhBdx.js";import{S as je}from"./switch-EwwwBXc8.js";import{A as ge,a as fe,b as ye,c as Ne,d as Ce,e as be,f as ve,g as we,h as De}from"./alert-dialog-BzBJRESa.js";import{L as m}from"./loader-circle-DjIWaf7f.js";import{P as Ae}from"./plus-DIUrj948.js";import{E as Se}from"./ellipsis-yQlqSxW1.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./useTranslation-CmIvGiqX.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./index-CENxNQLL.js";const Te=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Le=Z("database",Te);function ls({accounts:n,parents:F,types:M}){console.log("COA accounts received:",n),console.log("COA total accounts:",Object.values(n||{}).reduce((s,a)=>s+(a?.length||0),0));const N={asset:"Assets",liability:"Liabilities",equity:"Equity",income:"Revenue / Income",cogs:"Cost of Goods Sold",expense:"Expenses"},P={asset:"text-blue-600",liability:"text-red-600",equity:"text-purple-600",income:"text-green-600",cogs:"text-orange-600",expense:"text-orange-600"},[C,H]=u.useState({asset:!0,liability:!0,equity:!0,income:!0,cogs:!0,expense:!0}),[B,p]=u.useState(!1),[R,b]=u.useState(!1),[o,h]=u.useState(!1),{data:r,setData:i,post:q,processing:v,errors:t,reset:V}=Q({code:"",name:"",type:"",subtype:"",parent_id:"",description:"",is_active:!0}),z=Object.values(n).reduce((s,a)=>s+(a?.length||0),0),G=s=>{H(a=>({...a,[s]:!a[s]}))},Y=s=>{confirm("Are you sure you want to delete this account?")&&j.delete(route("accounting.coa.destroy",s))},J=s=>{s.preventDefault(),q(route("accounting.coa.store"),{onSuccess:()=>{p(!1),V()}})},K=()=>{b(!1),h(!0),j.post(route("accounting.coa.seed-defaults"),{},{preserveScroll:!0,onSuccess:()=>{h(!1),j.reload()},onError:s=>{h(!1),console.error("Error seeding defaults:",s)},onFinish:()=>{h(!1)}})};return e.jsxs(X,{header:"Chart of Accounts",children:[e.jsx(U,{title:"Chart of Accounts"}),e.jsxs("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Chart of Accounts"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[z===0&&e.jsxs(ge,{open:R,onOpenChange:b,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(d,{variant:"outline",disabled:o,children:[o&&e.jsx(m,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Load Default GL Accounts"]})}),e.jsxs(ye,{children:[e.jsxs(Ne,{children:[e.jsx(Ce,{children:"Load Malaysian Default Chart of Accounts?"}),e.jsx(be,{asChild:!0,children:e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-foreground",children:"⚠️ This is a one-time action that cannot be undone easily."}),e.jsx("p",{children:"This will create a standard Chart of Accounts based on Malaysian accounting practices, including:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 mt-2 text-sm",children:[e.jsx("li",{children:"Asset accounts (Bank, Cash, Inventory, Fixed Assets)"}),e.jsx("li",{children:"Liability accounts (Payables, Loans, Tax Payables)"}),e.jsx("li",{children:"Equity accounts (Capital, Retained Earnings)"}),e.jsx("li",{children:"Income/Revenue accounts"}),e.jsx("li",{children:"Cost of Goods Sold accounts"}),e.jsx("li",{children:"Expense accounts (including EPF, SOCSO, EIS)"})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-950 border border-yellow-200 dark:border-yellow-900 rounded-md",children:e.jsxs("span",{className:"text-xs font-medium text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Important:"})," This action can only be performed when the chart of accounts is empty. Once loaded, you cannot automatically reload defaults. You can customize these accounts after creation."]})})]})})]}),e.jsxs(ve,{children:[e.jsx(we,{children:"Cancel"}),e.jsx(De,{onClick:K,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):"Yes, Load Defaults"})]})]})]}),e.jsx(D,{open:o,onOpenChange:()=>{},children:e.jsxs(A,{className:"sm:max-w-md",hideClose:!0,children:[e.jsxs(S,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-5 w-5 animate-spin"}),"Loading Default Accounts"]}),e.jsx(L,{children:"Please wait while we create your default Chart of Accounts. This may take a few moments..."})]}),e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(m,{className:"h-12 w-12 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Creating 60+ default accounts for Malaysian businesses"})]})})]})}),e.jsxs(D,{open:B,onOpenChange:p,children:[e.jsx(me,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"})," New Account"]})}),e.jsxs(A,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(S,{children:[e.jsx(T,{children:"Create New Account"}),e.jsx(L,{children:"Add a new general ledger account to your chart of accounts."})]}),e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"code",children:"Account Code *"}),e.jsx(O,{id:"code",value:r.code,onChange:s=>i("code",s.target.value),placeholder:"e.g. 1001"}),t.code&&e.jsx("p",{className:"text-sm text-red-500",children:t.code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"type",children:"Account Type *"}),e.jsxs(_,{value:r.type,onValueChange:s=>i("type",s),children:[e.jsx(k,{children:e.jsx(E,{placeholder:"Select type"})}),e.jsx(I,{children:Object.entries(M||{}).map(([s,a])=>e.jsx(y,{value:s,children:a},s))})]}),t.type&&e.jsx("p",{className:"text-sm text-red-500",children:t.type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Account Name *"}),e.jsx(O,{id:"name",value:r.name,onChange:s=>i("name",s.target.value),placeholder:"e.g. Petty Cash"}),t.name&&e.jsx("p",{className:"text-sm text-red-500",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"parent_id",children:"Parent Account (Optional)"}),e.jsxs(_,{value:r.parent_id,onValueChange:s=>i("parent_id",s==="none"?"":s),children:[e.jsx(k,{children:e.jsx(E,{placeholder:"Select parent account (for nesting)"})}),e.jsxs(I,{children:[e.jsx(y,{value:"none",children:"No Parent"}),F?.map(s=>e.jsxs(y,{value:s.id.toString(),children:[s.code," - ",s.name]},s.id))]})]}),t.parent_id&&e.jsx("p",{className:"text-sm text-red-500",children:t.parent_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Description (Optional)"}),e.jsx(ue,{id:"description",value:r.description,onChange:s=>i("description",s.target.value),placeholder:"Internal notes about this account..."})]}),e.jsxs("div",{className:"flex items-center justify-between border p-4 rounded-md",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{className:"text-base",children:"Active Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inactive accounts cannot be used in new transactions."})]}),e.jsx(je,{checked:r.is_active,onCheckedChange:s=>i("is_active",s)})]}),e.jsxs(he,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(d,{type:"submit",disabled:v,children:[v&&e.jsx(m,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Account"]})]})]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:Object.keys(N).map(s=>e.jsxs($,{children:[e.jsx(ee,{className:"py-4 px-6 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>G(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[C[s]?e.jsx(pe,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(ie,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(se,{className:P[s],children:N[s]})]}),e.jsxs(f,{variant:"outline",children:[n[s]?.length||0," Accounts"]})]})}),C[s]&&e.jsx(ae,{className:"p-0",children:e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(g,{children:[e.jsx(x,{className:"w-[100px] pl-6",children:"Code"}),e.jsx(x,{children:"Account Name"}),e.jsx(x,{children:"Subtype"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right pr-6",children:"Actions"})]})}),e.jsxs(re,{children:[n[s]?.map(a=>e.jsxs(g,{children:[e.jsx(l,{className:"font-medium pl-6",children:a.code}),e.jsx(l,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.name}),a.parent&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Child of: ",a.parent.code," - ",a.parent.name]})]})}),e.jsx(l,{className:"capitalize",children:a.subtype?.replace("_"," ")||"-"}),e.jsx(l,{children:a.is_system?e.jsx(f,{variant:"secondary",className:"text-xs",children:"System"}):e.jsx(f,{variant:a.is_active?"outline":"destructive",children:a.is_active?"Active":"Inactive"})}),e.jsx(l,{className:"text-right pr-6",children:e.jsxs(le,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs(d,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Se,{className:"h-4 w-4"})]})}),e.jsxs(oe,{align:"end",children:[e.jsx(de,{children:"Actions"}),e.jsx(w,{asChild:!0,children:e.jsx(W,{href:route("accounting.coa.edit",a.id),children:"Edit Details"})}),!a.is_system&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{}),e.jsx(w,{onClick:()=>Y(a.id),className:"text-red-600 focus:text-red-600",children:"Delete"})]})]})]})})]},a.id)),(!n[s]||n[s].length===0)&&e.jsx(g,{children:e.jsx(l,{colSpan:5,className:"text-center py-6 text-muted-foreground",children:"No accounts found in this category."})})]})]})})]},s))})]})]})}export{ls as default};
