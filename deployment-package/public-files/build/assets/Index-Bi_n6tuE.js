import{r as h,u as z,i as $,j as e,H as G}from"./app-De9YtYVO.js";import{D as J}from"./DashboardLayout-DB0kk3mn.js";import{D as K}from"./data-table-D4pKVaNe.js";import{columns as U}from"./columns-BRKjajPj.js";import{B as p,a as k}from"./index-sqIKGjOx.js";import{D as W,a as X,b as Y,c as Z,d as ee,e as se,f as te}from"./dialog-B_EPHwqc.js";import{I as C}from"./input-YJ4y34zb.js";import{L as c}from"./label-BNYjQoyA.js";import{T as ae}from"./textarea-BrFMof27.js";import{S as w,a as S,b as D,c as F,d as o}from"./select-B2rqhBdx.js";import{P as re,a as ne,b as le,C as ie}from"./calendar-DDO4Otf0.js";import{f as u}from"./format-D9s8ZFBe.js";import{T as ce,a as oe,b as I,c as j,d as de,e as f}from"./table-3xAxy9mO.js";import{u as me}from"./useTranslation-CmIvGiqX.js";import{P as xe}from"./plus-DIUrj948.js";import{C as he}from"./calendar-DaZVa6bq.js";import{L as pe}from"./loader-circle-DjIWaf7f.js";import{f as P}from"./format-BS8Ay9AX.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./dropdown-menu-BBgrL1DT.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./checkbox-DSt0QHsS.js";import"./index-CENxNQLL.js";import"./trash-2-Dreerc3R.js";import"./arrow-up-down-1q5LzOz0.js";import"./ellipsis-yQlqSxW1.js";import"./chevron-left-BEvpDX_2.js";function Ye({receipts:A,customers:L,bankAccounts:B}){const{t}=me(),[H,b]=h.useState(!1),[y,g]=h.useState([]),[N,m]=h.useState({}),[M,T]=h.useState(!1),{data:a,setData:i,post:O,processing:R,errors:r,reset:E}=z({customer_id:"",bank_account_id:"",date:new Date,reference_number:"",amount:0,notes:"",payment_method:"Bank Transfer",allocations:[]}),v=a.customer_id,x=a.amount;h.useEffect(()=>{v?(T(!0),$.get(route("sales.customers.outstanding-invoices",v)).then(s=>{g(s.data),m({})}).catch(s=>{console.error("Failed to fetch invoices",s),g([])}).finally(()=>T(!1))):(g([]),m({}))},[v]);const V=()=>{let s=x;const n={};y.forEach(l=>{if(s>0){const d=Math.min(parseFloat(l.outstanding_amount.toString()),s);n[l.id]=parseFloat(d.toFixed(2)),s-=d}}),m(n)},q=s=>{s.preventDefault();const n=Object.entries(N).map(([l,d])=>({invoice_id:parseInt(l),amount:d})).filter(l=>l.amount>0);a.allocations=n,O(route("sales.receipts.store"),{onSuccess:()=>{b(!1),E(),m({}),g([])}})},_=Object.values(N).reduce((s,n)=>s+n,0),Q=x-_;return e.jsxs(J,{header:t("receipts.title"),children:[e.jsx(G,{title:t("receipts.title")}),e.jsxs("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:t("receipts.title")}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(W,{open:H,onOpenChange:b,children:[e.jsx(X,{asChild:!0,children:e.jsxs(p,{children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),t("receipts.create")]})}),e.jsxs(Y,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:t("receipts.create")}),e.jsx(se,{children:t("receipts.new")})]}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"customer_id",children:t("sales.customer")}),e.jsxs(w,{value:a.customer_id,onValueChange:s=>i("customer_id",s),children:[e.jsx(S,{children:e.jsx(D,{placeholder:t("user.selectCompany")})}),e.jsx(F,{children:L?.map(s=>e.jsx(o,{value:s.id.toString(),children:s.name},s.id))})]}),r.customer_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.customer_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"bank_account_id",children:t("receipts.account")}),e.jsxs(w,{value:a.bank_account_id,onValueChange:s=>i("bank_account_id",s),children:[e.jsx(S,{children:e.jsx(D,{placeholder:t("user.selectCompany")})}),e.jsx(F,{children:B?.map(s=>e.jsxs(o,{value:s.id.toString(),children:[s.bank_name," - ",s.name]},s.id))})]}),r.bank_account_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.bank_account_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:t("sales.date")}),e.jsxs(re,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:k("w-full pl-3 text-left font-normal",!a.date&&"text-muted-foreground"),children:[a.date?P(a.date,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(he,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(le,{className:"w-auto p-0",align:"start",children:e.jsx(ie,{mode:"single",selected:a.date,onSelect:s=>s&&i("date",s),initialFocus:!0})})]}),r.date&&e.jsx("p",{className:"text-sm text-red-500",children:r.date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"reference_number",children:t("receipts.reference")}),e.jsx(C,{id:"reference_number",value:a.reference_number,onChange:s=>i("reference_number",s.target.value)}),r.reference_number&&e.jsx("p",{className:"text-sm text-red-500",children:r.reference_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"amount",children:t("receipts.amountReceived")}),e.jsx(C,{type:"number",step:"0.01",id:"amount",value:a.amount,onChange:s=>i("amount",parseFloat(s.target.value))}),r.amount&&e.jsx("p",{className:"text-sm text-red-500",children:r.amount})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"payment_method",children:t("receipts.paymentMethod")}),e.jsxs(w,{value:a.payment_method,onValueChange:s=>i("payment_method",s),children:[e.jsx(S,{children:e.jsx(D,{placeholder:t("common.search")})}),e.jsxs(F,{children:[e.jsx(o,{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx(o,{value:"Cash",children:"Cash"}),e.jsx(o,{value:"Cheque",children:"Cheque"}),e.jsx(o,{value:"Credit Card",children:"Credit Card"}),e.jsx(o,{value:"DuitNow/QR",children:"DuitNow/QR"})]})]}),r.payment_method&&e.jsx("p",{className:"text-sm text-red-500",children:r.payment_method})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 space-y-2",children:[e.jsx(c,{htmlFor:"notes",children:t("quotations.notes")}),e.jsx(ae,{id:"notes",value:a.notes,onChange:s=>i("notes",s.target.value)})]})]}),v&&e.jsxs("div",{className:"border rounded-md p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:t("receipts.allocateInvoices")}),e.jsx(p,{type:"button",variant:"secondary",size:"sm",onClick:V,disabled:x<=0,children:t("receipts.autoAllocate")})]}),M?e.jsxs("div",{className:"text-center py-4 flex items-center justify-center",children:[e.jsx(pe,{className:"h-6 w-6 animate-spin mr-2"}),t("common.loading")]}):y.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:t("receipts.noInvoices")}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(I,{children:[e.jsx(j,{children:t("invoices.number")}),e.jsx(j,{children:t("sales.date")}),e.jsx(j,{className:"text-right",children:t("sales.amount")}),e.jsx(j,{className:"text-right",children:t("receipts.outstanding")}),e.jsx(j,{className:"w-[150px] text-right",children:t("receipts.allocation")})]})}),e.jsx(de,{children:y.map(s=>e.jsxs(I,{children:[e.jsx(f,{className:"font-medium",children:s.reference_number}),e.jsx(f,{children:P(new Date(s.date),"dd/MM/yyyy")}),e.jsx(f,{className:"text-right",children:u(parseFloat(s.total.toString()))}),e.jsx(f,{className:"text-right font-bold text-red-600",children:u(parseFloat(s.outstanding_amount.toString()))}),e.jsx(f,{children:e.jsx(C,{type:"number",step:"0.01",className:"text-right h-8",value:N[s.id]||"",onChange:n=>{const l=parseFloat(n.target.value)||0;m(d=>({...d,[s.id]:Math.min(l,parseFloat(s.outstanding_amount.toString()))}))}})})]},s.id))})]}),e.jsxs("div",{className:"flex justify-end gap-6 text-sm border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between w-48",children:[e.jsxs("span",{children:[t("receipts.receivedAmount"),":"]}),e.jsx("span",{className:"font-bold",children:u(x)})]}),e.jsxs("div",{className:"flex justify-between w-48",children:[e.jsxs("span",{children:[t("receipts.allocated"),":"]}),e.jsx("span",{className:k("font-bold",_>x?"text-red-500":"text-green-600"),children:u(_)})]}),e.jsxs("div",{className:"flex justify-between w-48",children:[e.jsxs("span",{children:[t("receipts.unallocated"),":"]}),e.jsx("span",{className:"font-bold",children:u(Q)})]})]})]})]}),e.jsxs(te,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>b(!1),children:t("common.cancel")}),e.jsx(p,{type:"submit",disabled:R,children:t("receipts.create")})]})]})]})]})})]}),e.jsx("div",{className:"hidden h-full flex-1 flex-col space-y-8 md:flex",children:e.jsx(K,{columns:U,data:A.data})})]})]})}export{Ye as default};
