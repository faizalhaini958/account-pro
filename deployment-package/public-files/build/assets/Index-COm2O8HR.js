import{r as R,u as V,j as e,H as $}from"./app-De9YtYVO.js";import{D as z}from"./DashboardLayout-DB0kk3mn.js";import{D as E}from"./data-table-D4pKVaNe.js";import{columns as M}from"./columns-Bqix9rHr.js";import{B as d,a as A}from"./index-sqIKGjOx.js";import{D as Q,a as G,b as J,c as K,d as U,e as W,f as X}from"./dialog-B_EPHwqc.js";import{I as h}from"./input-YJ4y34zb.js";import{L as j}from"./label-BNYjQoyA.js";import{T as Y}from"./textarea-BrFMof27.js";import{S as b,a as y,b as N,c as _,d as w}from"./select-B2rqhBdx.js";import{P as Z,a as ee,b as se,C as te}from"./calendar-DDO4Otf0.js";import{T as ae,a as re,b as C,c as o,d as ie,e as m}from"./table-3xAxy9mO.js";import{f as T}from"./format-D9s8ZFBe.js";import{u as ne}from"./useTranslation-CmIvGiqX.js";import{P as D}from"./plus-DIUrj948.js";import{C as le}from"./calendar-DaZVa6bq.js";import{T as ce}from"./trash-2-Dreerc3R.js";import{L as oe}from"./loader-circle-DjIWaf7f.js";import{f as me}from"./format-BS8Ay9AX.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./dropdown-menu-BBgrL1DT.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./checkbox-DSt0QHsS.js";import"./index-CENxNQLL.js";import"./badge-C9h6T3rK.js";import"./arrow-up-down-1q5LzOz0.js";import"./ellipsis-yQlqSxW1.js";import"./chevron-left-BEvpDX_2.js";function Ue({invoices:S,customers:F,products:g}){const{t:a}=ne(),[I,f]=R.useState(!1),{data:i,setData:c,post:q,processing:v,errors:l,reset:P}=V({customer_id:"",reference_number:"",date:new Date,due_date:new Date,notes:"",items:[{product_id:"",description:"",quantity:1,unit_price:0,tax_percent:0}]}),k=()=>{c("items",[...i.items,{product_id:"",description:"",quantity:1,unit_price:0,tax_percent:0}])},H=s=>{if(i.items.length<=1)return;const r=i.items.filter((t,n)=>n!==s);c("items",r)},p=(s,r,t)=>{const n=[...i.items];if(r==="product_id"){const x=g.find(u=>u.id.toString()===t);x?n[s]={...n[s],product_id:t,description:x.name,unit_price:x.retail_price||0}:n[s]={...n[s],[r]:t}}else n[s]={...n[s],[r]:t};c("items",n)},L=()=>i.items.reduce((s,r)=>{const t=r.quantity||0,n=r.unit_price||0,x=r.tax_percent||0,u=t*n,O=u*(x/100);return s+u+O},0),B=s=>{s.preventDefault(),q(route("sales.invoices.store"),{onSuccess:()=>{f(!1),P()}})};return e.jsxs(z,{header:a("invoices.title"),children:[e.jsx($,{title:a("invoices.title")}),e.jsxs("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:a("invoices.title")}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(Q,{open:I,onOpenChange:f,children:[e.jsx(G,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),a("invoices.new")]})}),e.jsxs(J,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsx(U,{children:a("invoices.create")}),e.jsx(W,{children:a("invoices.new")})]}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-1 lg:col-span-2 space-y-2",children:[e.jsx(j,{htmlFor:"customer_id",children:a("sales.customer")}),e.jsxs(b,{value:i.customer_id,onValueChange:s=>c("customer_id",s),children:[e.jsx(y,{children:e.jsx(N,{placeholder:a("user.selectCompany")})}),e.jsx(_,{children:F?.map(s=>e.jsx(w,{value:s.id.toString(),children:s.name},s.id))})]}),l.customer_id&&e.jsx("p",{className:"text-sm text-red-500",children:l.customer_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"reference_number",children:a("invoices.reference")}),e.jsx(h,{id:"reference_number",value:i.reference_number,onChange:s=>c("reference_number",s.target.value),placeholder:"Optional"}),l.reference_number&&e.jsx("p",{className:"text-sm text-red-500",children:l.reference_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:a("sales.date")}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:A("w-full pl-3 text-left font-normal",!i.date&&"text-muted-foreground"),children:[i.date?me(i.date,"dd/MM/yyyy"):e.jsx("span",{children:"Pick a date"}),e.jsx(le,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(se,{className:"w-auto p-0",align:"start",children:e.jsx(te,{mode:"single",selected:i.date,onSelect:s=>s&&c("date",s),initialFocus:!0})})]}),l.date&&e.jsx("p",{className:"text-sm text-red-500",children:l.date})]})]}),e.jsxs("div",{className:"border rounded-md p-4 bg-muted/20",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-medium",children:a("invoices.items")})}),e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(C,{children:[e.jsx(o,{className:"w-[30%]",children:a("products.name")}),e.jsx(o,{className:"w-[20%]",children:a("products.description")}),e.jsx(o,{className:"w-[10%]",children:"Qty"}),e.jsx(o,{className:"w-[15%]",children:a("products.retailPrice")}),e.jsx(o,{className:"w-[10%]",children:"Tax %"}),e.jsx(o,{className:"w-[15%] text-right",children:a("sales.amount")}),e.jsx(o,{className:"w-[5%]"})]})}),e.jsx(ie,{children:i.items.map((s,r)=>e.jsxs(C,{children:[e.jsx(m,{children:e.jsxs(b,{value:s.product_id,onValueChange:t=>p(r,"product_id",t),children:[e.jsx(y,{children:e.jsx(N,{placeholder:"Select"})}),e.jsx(_,{children:g?.map(t=>e.jsx(w,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsxs(m,{children:[e.jsx(h,{value:s.description,onChange:t=>p(r,"description",t.target.value)}),l[`items.${r}.description`]&&e.jsx("p",{className:"text-sm text-red-500",children:l[`items.${r}.description`]})]}),e.jsx(m,{children:e.jsx(h,{type:"number",min:"0",step:"1",value:s.quantity,onChange:t=>p(r,"quantity",parseFloat(t.target.value)||0)})}),e.jsx(m,{children:e.jsx(h,{type:"number",min:"0",step:"0.01",value:s.unit_price,onChange:t=>p(r,"unit_price",parseFloat(t.target.value)||0)})}),e.jsx(m,{children:e.jsx(h,{type:"number",min:"0",step:"1",value:s.tax_percent,onChange:t=>p(r,"tax_percent",parseFloat(t.target.value)||0)})}),e.jsx(m,{className:"text-right font-medium",children:T(s.quantity*s.unit_price*(1+s.tax_percent/100))}),e.jsx(m,{children:e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>H(r),children:e.jsx(ce,{className:"h-4 w-4 text-red-500"})})})]},r))})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:k,children:[e.jsx(D,{className:"mr-2 h-4 w-4"})," ",a("common.create")]}),e.jsxs("div",{className:"text-lg font-bold",children:[a("sales.amount"),": ",T(L())]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"notes",children:a("quotations.notes")}),e.jsx(Y,{id:"notes",value:i.notes,onChange:s=>c("notes",s.target.value),placeholder:"Terms and conditions..."})]}),e.jsxs(X,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>f(!1),children:a("common.cancel")}),e.jsxs(d,{type:"submit",disabled:v,children:[v&&e.jsx(oe,{className:"mr-2 h-4 w-4 animate-spin"}),a("invoices.create")]})]})]})]})]})})]}),e.jsx("div",{className:"hidden h-full flex-1 flex-col space-y-8 md:flex",children:e.jsx(E,{columns:M,data:S.data})})]})]})}export{Ue as default};
