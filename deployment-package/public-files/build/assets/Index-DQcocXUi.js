import{r as s,j as e,u as Ue,H as We,i as Je}from"./app-De9YtYVO.js";import{D as Qe}from"./DashboardLayout-DB0kk3mn.js";import{D as Xe}from"./data-table-D4pKVaNe.js";import{columns as Ye}from"./columns-Cydx3ds0.js";import{P as q,g as re,a as M,B as O,C as Ze}from"./index-sqIKGjOx.js";import{D as et,a as tt,b as rt,c as at,d as nt,e as lt,f as st}from"./dialog-B_EPHwqc.js";import{I as Y}from"./input-YJ4y34zb.js";import{L as Z}from"./label-BNYjQoyA.js";import{T as be}from"./textarea-BrFMof27.js";import{S as je,a as ye,b as we,c as Ne,d as Ce}from"./select-B2rqhBdx.js";import{P as Se,a as ke,b as _e,C as it}from"./calendar-DDO4Otf0.js";import{T as ot,a as ct,b as Ie,c as V,d as dt,e as K}from"./table-3xAxy9mO.js";import{f as ee}from"./format-D9s8ZFBe.js";import{R as ut,P as mt,O as pt,C as ft}from"./index-DEhQiHRI.js";import{f as J}from"./Combination-Dy-FKPUP.js";import{S as ht}from"./search-BkjZB7Ok.js";import{u as xt}from"./useTranslation-CmIvGiqX.js";import{P as Ee}from"./plus-DIUrj948.js";import{C as vt}from"./toaster-CljvMPLZ.js";import{C as gt}from"./calendar-DaZVa6bq.js";import{T as bt}from"./trash-2-Dreerc3R.js";import{L as jt}from"./loader-circle-DjIWaf7f.js";import{f as yt}from"./format-BS8Ay9AX.js";import"./dropdown-menu-BBgrL1DT.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./checkbox-DSt0QHsS.js";import"./index-CENxNQLL.js";import"./badge-C9h6T3rK.js";import"./arrow-up-down-1q5LzOz0.js";import"./ellipsis-yQlqSxW1.js";import"./x-D7kv7_oa.js";import"./chevron-left-BEvpDX_2.js";var Re=1,wt=.9,Nt=.8,Ct=.17,ce=.1,de=.999,St=.9999,kt=.99,_t=/[\\\/_+.#"@\[\(\{&]/,It=/[\\\/_+.#"@\[\(\{&]/g,Et=/[\s-]/,Fe=/[\s-]/g;function me(t,n,r,h,c,d,p){if(d===n.length)return c===t.length?Re:kt;var x=`${c},${d}`;if(p[x]!==void 0)return p[x];for(var y=h.charAt(d),i=r.indexOf(y,c),f=0,j,S,C,E;i>=0;)j=me(t,n,r,h,i+1,d+1,p),j>f&&(i===c?j*=Re:_t.test(t.charAt(i-1))?(j*=Nt,C=t.slice(c,i-1).match(It),C&&c>0&&(j*=Math.pow(de,C.length))):Et.test(t.charAt(i-1))?(j*=wt,E=t.slice(c,i-1).match(Fe),E&&c>0&&(j*=Math.pow(de,E.length))):(j*=Ct,c>0&&(j*=Math.pow(de,i-c))),t.charAt(i)!==n.charAt(d)&&(j*=St)),(j<ce&&r.charAt(i-1)===h.charAt(d+1)||h.charAt(d+1)===h.charAt(d)&&r.charAt(i-1)!==h.charAt(d))&&(S=me(t,n,r,h,i+1,d+2,p),S*ce>j&&(j=S*ce)),j>f&&(f=j),i=r.indexOf(y,i+1);return p[x]=f,f}function De(t){return t.toLowerCase().replace(Fe," ")}function Rt(t,n,r){return t=r&&r.length>0?`${t+" "+r.join(" ")}`:t,me(t,n,De(t),De(n),0,0,{})}var te='[cmdk-group=""]',ue='[cmdk-group-items=""]',Dt='[cmdk-group-heading=""]',Ae='[cmdk-item=""]',Te=`${Ae}:not([aria-disabled="true"])`,pe="cmdk-item-select",U="data-value",Tt=(t,n,r)=>Rt(t,n,r),Pe=s.createContext(void 0),ae=()=>s.useContext(Pe),Me=s.createContext(void 0),fe=()=>s.useContext(Me),$e=s.createContext(void 0),qe=s.forwardRef((t,n)=>{let r=W(()=>{var a,u;return{search:"",value:(u=(a=t.value)!=null?a:t.defaultValue)!=null?u:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),h=W(()=>new Set),c=W(()=>new Map),d=W(()=>new Map),p=W(()=>new Set),x=Le(t),{label:y,children:i,value:f,onValueChange:j,filter:S,shouldFilter:C,loop:E,disablePointerSelection:H=!1,vimBindings:T=!0,...z}=t,R=J(),se=J(),A=J(),F=s.useRef(null),l=Bt();B(()=>{if(f!==void 0){let a=f.trim();r.current.value=a,m.emit()}},[f]),B(()=>{l(6,Q)},[]);let m=s.useMemo(()=>({subscribe:a=>(p.current.add(a),()=>p.current.delete(a)),snapshot:()=>r.current,setState:(a,u,v)=>{var o,b,N,I;if(!Object.is(r.current[a],u)){if(r.current[a]=u,a==="search")G(),D(),l(1,L);else if(a==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let k=document.getElementById(A);k?k.focus():(o=document.getElementById(R))==null||o.focus()}if(l(7,()=>{var k;r.current.selectedItemId=(k=P())==null?void 0:k.id,m.emit()}),v||l(5,Q),((b=x.current)==null?void 0:b.value)!==void 0){let k=u??"";(I=(N=x.current).onValueChange)==null||I.call(N,k);return}}m.emit()}},emit:()=>{p.current.forEach(a=>a())}}),[]),g=s.useMemo(()=>({value:(a,u,v)=>{var o;u!==((o=d.current.get(a))==null?void 0:o.value)&&(d.current.set(a,{value:u,keywords:v}),r.current.filtered.items.set(a,w(u,v)),l(2,()=>{D(),m.emit()}))},item:(a,u)=>(h.current.add(a),u&&(c.current.has(u)?c.current.get(u).add(a):c.current.set(u,new Set([a]))),l(3,()=>{G(),D(),r.current.value||L(),m.emit()}),()=>{d.current.delete(a),h.current.delete(a),r.current.filtered.items.delete(a);let v=P();l(4,()=>{G(),v?.getAttribute("id")===a&&L(),m.emit()})}),group:a=>(c.current.has(a)||c.current.set(a,new Set),()=>{d.current.delete(a),c.current.delete(a)}),filter:()=>x.current.shouldFilter,label:y||t["aria-label"],getDisablePointerSelection:()=>x.current.disablePointerSelection,listId:R,inputId:A,labelId:se,listInnerRef:F}),[]);function w(a,u){var v,o;let b=(o=(v=x.current)==null?void 0:v.filter)!=null?o:Tt;return a?b(a,r.current.search,u):0}function D(){if(!r.current.search||x.current.shouldFilter===!1)return;let a=r.current.filtered.items,u=[];r.current.filtered.groups.forEach(o=>{let b=c.current.get(o),N=0;b.forEach(I=>{let k=a.get(I);N=Math.max(k,N)}),u.push([o,N])});let v=F.current;X().sort((o,b)=>{var N,I;let k=o.getAttribute("id"),ne=b.getAttribute("id");return((N=a.get(ne))!=null?N:0)-((I=a.get(k))!=null?I:0)}).forEach(o=>{let b=o.closest(ue);b?b.appendChild(o.parentElement===b?o:o.closest(`${ue} > *`)):v.appendChild(o.parentElement===v?o:o.closest(`${ue} > *`))}),u.sort((o,b)=>b[1]-o[1]).forEach(o=>{var b;let N=(b=F.current)==null?void 0:b.querySelector(`${te}[${U}="${encodeURIComponent(o[0])}"]`);N?.parentElement.appendChild(N)})}function L(){let a=X().find(v=>v.getAttribute("aria-disabled")!=="true"),u=a?.getAttribute(U);m.setState("value",u||void 0)}function G(){var a,u,v,o;if(!r.current.search||x.current.shouldFilter===!1){r.current.filtered.count=h.current.size;return}r.current.filtered.groups=new Set;let b=0;for(let N of h.current){let I=(u=(a=d.current.get(N))==null?void 0:a.value)!=null?u:"",k=(o=(v=d.current.get(N))==null?void 0:v.keywords)!=null?o:[],ne=w(I,k);r.current.filtered.items.set(N,ne),ne>0&&b++}for(let[N,I]of c.current)for(let k of I)if(r.current.filtered.items.get(k)>0){r.current.filtered.groups.add(N);break}r.current.filtered.count=b}function Q(){var a,u,v;let o=P();o&&(((a=o.parentElement)==null?void 0:a.firstChild)===o&&((v=(u=o.closest(te))==null?void 0:u.querySelector(Dt))==null||v.scrollIntoView({block:"nearest"})),o.scrollIntoView({block:"nearest"}))}function P(){var a;return(a=F.current)==null?void 0:a.querySelector(`${Ae}[aria-selected="true"]`)}function X(){var a;return Array.from(((a=F.current)==null?void 0:a.querySelectorAll(Te))||[])}function ie(a){let u=X()[a];u&&m.setState("value",u.getAttribute(U))}function oe(a){var u;let v=P(),o=X(),b=o.findIndex(I=>I===v),N=o[b+a];(u=x.current)!=null&&u.loop&&(N=b+a<0?o[o.length-1]:b+a===o.length?o[0]:o[b+a]),N&&m.setState("value",N.getAttribute(U))}function he(a){let u=P(),v=u?.closest(te),o;for(;v&&!o;)v=a>0?Vt(v,te):Kt(v,te),o=v?.querySelector(Te);o?m.setState("value",o.getAttribute(U)):oe(a)}let xe=()=>ie(X().length-1),ve=a=>{a.preventDefault(),a.metaKey?xe():a.altKey?he(1):oe(1)},ge=a=>{a.preventDefault(),a.metaKey?ie(0):a.altKey?he(-1):oe(-1)};return s.createElement(q.div,{ref:n,tabIndex:-1,...z,"cmdk-root":"",onKeyDown:a=>{var u;(u=z.onKeyDown)==null||u.call(z,a);let v=a.nativeEvent.isComposing||a.keyCode===229;if(!(a.defaultPrevented||v))switch(a.key){case"n":case"j":{T&&a.ctrlKey&&ve(a);break}case"ArrowDown":{ve(a);break}case"p":case"k":{T&&a.ctrlKey&&ge(a);break}case"ArrowUp":{ge(a);break}case"Home":{a.preventDefault(),ie(0);break}case"End":{a.preventDefault(),xe();break}case"Enter":{a.preventDefault();let o=P();if(o){let b=new Event(pe);o.dispatchEvent(b)}}}}},s.createElement("label",{"cmdk-label":"",htmlFor:g.inputId,id:g.labelId,style:zt},y),le(t,a=>s.createElement(Me.Provider,{value:m},s.createElement(Pe.Provider,{value:g},a))))}),Ft=s.forwardRef((t,n)=>{var r,h;let c=J(),d=s.useRef(null),p=s.useContext($e),x=ae(),y=Le(t),i=(h=(r=y.current)==null?void 0:r.forceMount)!=null?h:p?.forceMount;B(()=>{if(!i)return x.item(c,p?.id)},[i]);let f=Oe(c,d,[t.value,t.children,d],t.keywords),j=fe(),S=$(l=>l.value&&l.value===f.current),C=$(l=>i||x.filter()===!1?!0:l.search?l.filtered.items.get(c)>0:!0);s.useEffect(()=>{let l=d.current;if(!(!l||t.disabled))return l.addEventListener(pe,E),()=>l.removeEventListener(pe,E)},[C,t.onSelect,t.disabled]);function E(){var l,m;H(),(m=(l=y.current).onSelect)==null||m.call(l,f.current)}function H(){j.setState("value",f.current,!0)}if(!C)return null;let{disabled:T,value:z,onSelect:R,forceMount:se,keywords:A,...F}=t;return s.createElement(q.div,{ref:re(d,n),...F,id:c,"cmdk-item":"",role:"option","aria-disabled":!!T,"aria-selected":!!S,"data-disabled":!!T,"data-selected":!!S,onPointerMove:T||x.getDisablePointerSelection()?void 0:H,onClick:T?void 0:E},t.children)}),At=s.forwardRef((t,n)=>{let{heading:r,children:h,forceMount:c,...d}=t,p=J(),x=s.useRef(null),y=s.useRef(null),i=J(),f=ae(),j=$(C=>c||f.filter()===!1?!0:C.search?C.filtered.groups.has(p):!0);B(()=>f.group(p),[]),Oe(p,x,[t.value,t.heading,y]);let S=s.useMemo(()=>({id:p,forceMount:c}),[c]);return s.createElement(q.div,{ref:re(x,n),...d,"cmdk-group":"",role:"presentation",hidden:j?void 0:!0},r&&s.createElement("div",{ref:y,"cmdk-group-heading":"","aria-hidden":!0,id:i},r),le(t,C=>s.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?i:void 0},s.createElement($e.Provider,{value:S},C))))}),Pt=s.forwardRef((t,n)=>{let{alwaysRender:r,...h}=t,c=s.useRef(null),d=$(p=>!p.search);return!r&&!d?null:s.createElement(q.div,{ref:re(c,n),...h,"cmdk-separator":"",role:"separator"})}),Mt=s.forwardRef((t,n)=>{let{onValueChange:r,...h}=t,c=t.value!=null,d=fe(),p=$(i=>i.search),x=$(i=>i.selectedItemId),y=ae();return s.useEffect(()=>{t.value!=null&&d.setState("search",t.value)},[t.value]),s.createElement(q.input,{ref:n,...h,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":y.listId,"aria-labelledby":y.labelId,"aria-activedescendant":x,id:y.inputId,type:"text",value:c?t.value:p,onChange:i=>{c||d.setState("search",i.target.value),r?.(i.target.value)}})}),$t=s.forwardRef((t,n)=>{let{children:r,label:h="Suggestions",...c}=t,d=s.useRef(null),p=s.useRef(null),x=$(i=>i.selectedItemId),y=ae();return s.useEffect(()=>{if(p.current&&d.current){let i=p.current,f=d.current,j,S=new ResizeObserver(()=>{j=requestAnimationFrame(()=>{let C=i.offsetHeight;f.style.setProperty("--cmdk-list-height",C.toFixed(1)+"px")})});return S.observe(i),()=>{cancelAnimationFrame(j),S.unobserve(i)}}},[]),s.createElement(q.div,{ref:re(d,n),...c,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":x,"aria-label":h,id:y.listId},le(t,i=>s.createElement("div",{ref:re(p,y.listInnerRef),"cmdk-list-sizer":""},i)))}),qt=s.forwardRef((t,n)=>{let{open:r,onOpenChange:h,overlayClassName:c,contentClassName:d,container:p,...x}=t;return s.createElement(ut,{open:r,onOpenChange:h},s.createElement(mt,{container:p},s.createElement(pt,{"cmdk-overlay":"",className:c}),s.createElement(ft,{"aria-label":t.label,"cmdk-dialog":"",className:d},s.createElement(qe,{ref:n,...x}))))}),Lt=s.forwardRef((t,n)=>$(r=>r.filtered.count===0)?s.createElement(q.div,{ref:n,...t,"cmdk-empty":"",role:"presentation"}):null),Ot=s.forwardRef((t,n)=>{let{progress:r,children:h,label:c="Loading...",...d}=t;return s.createElement(q.div,{ref:n,...d,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":c},le(t,p=>s.createElement("div",{"aria-hidden":!0},p)))}),_=Object.assign(qe,{List:$t,Item:Ft,Input:Mt,Group:At,Separator:Pt,Dialog:qt,Empty:Lt,Loading:Ot});function Vt(t,n){let r=t.nextElementSibling;for(;r;){if(r.matches(n))return r;r=r.nextElementSibling}}function Kt(t,n){let r=t.previousElementSibling;for(;r;){if(r.matches(n))return r;r=r.previousElementSibling}}function Le(t){let n=s.useRef(t);return B(()=>{n.current=t}),n}var B=typeof window>"u"?s.useEffect:s.useLayoutEffect;function W(t){let n=s.useRef();return n.current===void 0&&(n.current=t()),n}function $(t){let n=fe(),r=()=>t(n.snapshot());return s.useSyncExternalStore(n.subscribe,r,r)}function Oe(t,n,r,h=[]){let c=s.useRef(),d=ae();return B(()=>{var p;let x=(()=>{var i;for(let f of r){if(typeof f=="string")return f.trim();if(typeof f=="object"&&"current"in f)return f.current?(i=f.current.textContent)==null?void 0:i.trim():c.current}})(),y=h.map(i=>i.trim());d.value(t,x,y),(p=n.current)==null||p.setAttribute(U,x),c.current=x}),c}var Bt=()=>{let[t,n]=s.useState(),r=W(()=>new Map);return B(()=>{r.current.forEach(h=>h()),r.current=new Map},[t]),(h,c)=>{r.current.set(h,c),n({})}};function Ht(t){let n=t.type;return typeof n=="function"?n(t.props):"render"in n?n.render(t.props):t}function le({asChild:t,children:n},r){return t&&s.isValidElement(n)?s.cloneElement(Ht(n),{ref:n.ref},r(n.props.children)):r(n)}var zt={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ve=s.forwardRef(({className:t,...n},r)=>e.jsx(_,{ref:r,className:M("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...n}));Ve.displayName=_.displayName;const Ke=s.forwardRef(({className:t,...n},r)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(ht,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(_.Input,{ref:r,className:M("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...n})]}));Ke.displayName=_.Input.displayName;const Be=s.forwardRef(({className:t,...n},r)=>e.jsx(_.List,{ref:r,className:M("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...n}));Be.displayName=_.List.displayName;const He=s.forwardRef((t,n)=>e.jsx(_.Empty,{ref:n,className:"py-6 text-center text-sm",...t}));He.displayName=_.Empty.displayName;const ze=s.forwardRef(({className:t,...n},r)=>e.jsx(_.Group,{ref:r,className:M("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...n}));ze.displayName=_.Group.displayName;const Gt=s.forwardRef(({className:t,...n},r)=>e.jsx(_.Separator,{ref:r,className:M("-mx-1 h-px bg-border",t),...n}));Gt.displayName=_.Separator.displayName;const Ge=s.forwardRef(({className:t,...n},r)=>e.jsx(_.Item,{ref:r,className:M("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...n}));Ge.displayName=_.Item.displayName;function Tr({creditNotes:t,customers:n,products:r,invoices:h=[]}){const{t:c}=xt(),[d,p]=s.useState(!1),[x,y]=s.useState(!1),{data:i,setData:f,post:j,processing:S,errors:C,reset:E}=Ue({customer_id:"",invoice_id:"",date:new Date,reason:"",notes:"",items:[{product_id:"",description:"",quantity:1,unit_price:0,tax_percent:0,discount_amount:0}]}),H=h.filter(l=>i.customer_id?l.customer_id.toString()===i.customer_id:!1),T=()=>{f("items",[...i.items,{product_id:"",description:"",quantity:1,unit_price:0,tax_percent:0,discount_amount:0}])},z=l=>{if(i.items.length<=1)return;const m=i.items.filter((g,w)=>w!==l);f("items",m)},R=(l,m,g)=>{const w=[...i.items];if(m==="product_id"){const D=r.find(L=>L.id.toString()===g);D?w[l]={...w[l],product_id:g,description:D.name,unit_price:parseFloat(D.retail_price)||0}:w[l]={...w[l],[m]:g}}else w[l]={...w[l],[m]:g};f("items",w)},A=i.items.reduce((l,m)=>{const g=m.quantity||0,w=m.unit_price||0,D=m.discount_amount||0,L=m.tax_percent||0,G=g*w-D,Q=G*(L/100),P=G+Q;return{subtotal:l.subtotal+g*w,discount:l.discount+D,tax:l.tax+Q,total:l.total+P}},{subtotal:0,discount:0,tax:0,total:0}),F=l=>{l.preventDefault(),j(route("sales.credit-notes.store"),{onSuccess:()=>{p(!1),E()}})};return e.jsxs(Qe,{header:"Credit Notes",children:[e.jsx(We,{title:"Credit Notes"}),e.jsxs("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Credit Notes"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(et,{open:d,onOpenChange:p,children:[e.jsx(tt,{asChild:!0,children:e.jsxs(O,{children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Create Credit Note"]})}),e.jsxs(rt,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(at,{children:[e.jsx(nt,{children:"Create New Credit Note"}),e.jsx(lt,{children:"Create a new credit note for a customer."})]}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-1 lg:col-span-2 space-y-2",children:[e.jsx(Z,{htmlFor:"customer_id",children:"Customer"}),e.jsxs(je,{value:i.customer_id,onValueChange:l=>{f({...i,customer_id:l,invoice_id:""})},children:[e.jsx(ye,{children:e.jsx(we,{placeholder:"Select Customer"})}),e.jsx(Ne,{children:n?.map(l=>e.jsxs(Ce,{value:l.id.toString(),children:[l.name," ",l.company_name?`(${l.company_name})`:""]},l.id))})]}),C.customer_id&&e.jsx("p",{className:"text-sm text-red-500",children:C.customer_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"invoice_id",children:"Reference Invoice"}),e.jsxs(Se,{open:x,onOpenChange:y,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(O,{variant:"outline",role:"combobox","aria-expanded":x,className:"w-full justify-between",disabled:!i.customer_id,children:[i.invoice_id?H.find(l=>l.id.toString()===i.invoice_id)?.number:i.customer_id?"Select Invoice...":"Select Customer First",e.jsx(vt,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(_e,{className:"w-[--radix-popover-trigger-width] p-0",children:e.jsxs(Ve,{children:[e.jsx(Ke,{placeholder:"Search invoice..."}),e.jsxs(Be,{children:[e.jsx(He,{children:"No invoice found."}),e.jsx(ze,{children:H.map(l=>e.jsxs(Ge,{value:l.number,onSelect:async()=>{y(!1),f(m=>({...m,invoice_id:l.id.toString()}));try{const g=(await Je.get(route("sales.invoices.items",l.id))).data.items.map(w=>({product_id:w.product_id?.toString()||"",description:w.description,quantity:Number(w.quantity),unit_price:Number(w.unit_price),tax_percent:Number(w.tax_percent),discount_amount:0}));g.length>0&&f(w=>({...w,invoice_id:l.id.toString(),items:g}))}catch(m){console.error("Failed to fetch invoice items",m)}},children:[e.jsx(Ze,{className:M("mr-2 h-4 w-4",i.invoice_id===l.id.toString()?"opacity-100":"opacity-0")}),l.number," (",ee(l.total),")"]},l.id))})]})]})})]}),C.invoice_id&&e.jsx("p",{className:"text-sm text-red-500",children:C.invoice_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"Date"}),e.jsxs(Se,{children:[e.jsx(ke,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:M("w-full pl-3 text-left font-normal",!i.date&&"text-muted-foreground"),children:[i.date?yt(i.date,"dd/MM/yyyy"):e.jsx("span",{children:"Pick a date"}),e.jsx(gt,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(_e,{className:"w-auto p-0",align:"start",children:e.jsx(it,{mode:"single",selected:i.date,onSelect:l=>l&&f("date",l),initialFocus:!0})})]}),C.date&&e.jsx("p",{className:"text-sm text-red-500",children:C.date})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"reason",children:"Reason"}),e.jsx(be,{id:"reason",value:i.reason,onChange:l=>f("reason",l.target.value),placeholder:"Reason for credit note..."})]}),e.jsxs("div",{className:"border rounded-md p-4 bg-muted/20",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-medium",children:"Items"})}),e.jsxs(ot,{children:[e.jsx(ct,{children:e.jsxs(Ie,{children:[e.jsx(V,{className:"w-[20%]",children:"Product"}),e.jsx(V,{className:"w-[25%]",children:"Description"}),e.jsx(V,{className:"w-[10%]",children:"Qty"}),e.jsx(V,{className:"w-[15%]",children:"Price"}),e.jsx(V,{className:"w-[10%]",children:"Disc."}),e.jsx(V,{className:"w-[10%]",children:"Tax %"}),e.jsx(V,{className:"w-[10%]"})]})}),e.jsx(dt,{children:i.items.map((l,m)=>e.jsxs(Ie,{children:[e.jsx(K,{children:e.jsxs(je,{value:l.product_id,onValueChange:g=>R(m,"product_id",g),children:[e.jsx(ye,{children:e.jsx(we,{placeholder:"Select Product"})}),e.jsx(Ne,{children:r?.map(g=>e.jsx(Ce,{value:g.id.toString(),children:g.sku},g.id))})]})}),e.jsx(K,{children:e.jsx(Y,{value:l.description,onChange:g=>R(m,"description",g.target.value)})}),e.jsx(K,{children:e.jsx(Y,{type:"number",min:"0",step:"1",value:l.quantity,onChange:g=>R(m,"quantity",parseFloat(g.target.value)||0)})}),e.jsx(K,{children:e.jsx(Y,{type:"number",min:"0",step:"0.01",value:l.unit_price,onChange:g=>R(m,"unit_price",parseFloat(g.target.value)||0)})}),e.jsx(K,{children:e.jsx(Y,{type:"number",min:"0",step:"0.01",value:l.discount_amount,onChange:g=>R(m,"discount_amount",parseFloat(g.target.value)||0)})}),e.jsx(K,{children:e.jsx(Y,{type:"number",min:"0",step:"1",value:l.tax_percent,onChange:g=>R(m,"tax_percent",parseFloat(g.target.value)||0)})}),e.jsx(K,{children:e.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:()=>z(m),children:e.jsx(bt,{className:"h-4 w-4 text-red-500"})})})]},m))})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs(O,{type:"button",variant:"outline",size:"sm",onClick:T,children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"})," Add Item"]}),e.jsxs("div",{className:"w-64 space-y-2 text-right text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal:"}),e.jsx("span",{children:ee(A.subtotal)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Discount:"}),e.jsx("span",{children:ee(A.discount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tax:"}),e.jsx("span",{children:ee(A.tax)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:ee(A.total)})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"notes",children:"Notes"}),e.jsx(be,{id:"notes",value:i.notes,onChange:l=>f("notes",l.target.value),placeholder:"Notes..."})]}),e.jsxs(st,{children:[e.jsx(O,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(O,{type:"submit",disabled:S,children:[S&&e.jsx(jt,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Credit Note"]})]})]})]})]})})]}),e.jsx("div",{className:"hidden h-full flex-1 flex-col space-y-8 md:flex",children:e.jsx(Xe,{columns:Ye,data:t.data})})]})]})}export{Tr as default};
