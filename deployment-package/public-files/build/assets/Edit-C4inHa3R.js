import{r as U,j as e,H as W,L as X,a as Y}from"./app-De9YtYVO.js";import{D as Z}from"./DashboardLayout-DB0kk3mn.js";import{B as l,a as w}from"./index-sqIKGjOx.js";import{C as u,a as x,b as p,c as h}from"./card-B1noy23o.js";import{I as o}from"./input-YJ4y34zb.js";import{L as j}from"./label-BNYjQoyA.js";import{T as ee}from"./textarea-BrFMof27.js";import{S,a as v,b as C,c as P,d as T}from"./select-B2rqhBdx.js";import{T as se,a as te,b as D,c as n,d as re,e as c}from"./table-3xAxy9mO.js";import{u as ae,a as ie,e as le,o as $,f as ne,s as d,d as q,n as y}from"./schemas-9rN0axaX.js";import{f}from"./format-D9s8ZFBe.js";import{P as V,a as F,b as A,C as E}from"./calendar-DDO4Otf0.js";import{u as ce}from"./useTranslation-CmIvGiqX.js";import{C as I}from"./calendar-DaZVa6bq.js";import{T as oe}from"./trash-2-Dreerc3R.js";import{P as de}from"./plus-DIUrj948.js";import{f as b}from"./format-BS8Ay9AX.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./dropdown-menu-BBgrL1DT.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./dialog-B_EPHwqc.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./index-CENxNQLL.js";import"./chevron-left-BEvpDX_2.js";const me=$({customer_id:d().min(1,"Customer is required"),date:q(),due_date:q(),reference_number:d().optional(),notes:d().optional().nullable(),items:ne($({product_id:d().optional().nullable(),description:d().min(1,"Description is required"),quantity:y().min(.01,"Quantity must be greater than 0"),unit_price:y().min(0,"Price must be positive"),tax_percent:y().min(0).optional().nullable()})).min(1,"At least one item is required")});function Je({invoice:i,customers:k,products:g}){const{t:ue}=ce(),[H,N]=U.useState(!1),t=ae({resolver:ie(me),defaultValues:{customer_id:i.customer_id.toString(),date:new Date(i.date),due_date:new Date(i.due_date),reference_number:i.reference_number,notes:i.notes,items:i.items.map(s=>({product_id:s.product_id?.toString(),description:s.description,quantity:parseFloat(s.quantity),unit_price:parseFloat(s.unit_price),tax_percent:parseFloat(s.tax_percent)}))}}),{fields:L,append:M,remove:B}=le({control:t.control,name:"items"}),_=t.watch("items"),R=()=>{let s=0,r=0;return _.forEach(a=>{const m=(a.quantity||0)*(a.unit_price||0),O=m*((a.tax_percent||0)/100);s+=m,r+=O}),{subtotal:s,tax:r,total:s+r}},{subtotal:z,tax:Q,total:G}=R(),J=s=>{N(!0),Y.put(route("sales.invoices.update",i.id),{...s,date:b(s.date,"yyyy-MM-dd"),due_date:b(s.due_date,"yyyy-MM-dd")},{onFinish:()=>N(!1)})},K=(s,r)=>{const a=g.find(m=>m.id.toString()===r);a&&(t.setValue(`items.${s}.description`,a.name),t.setValue(`items.${s}.unit_price`,parseFloat(a.retail_price.toString())),t.setValue(`items.${s}.product_id`,r))};return e.jsxs(Z,{header:`Edit Invoice: ${i.reference_number}`,children:[e.jsx(W,{title:`Edit Invoice: ${i.reference_number}`}),e.jsx("div",{className:"max-w-5xl mx-auto py-6",children:e.jsxs("form",{onSubmit:t.handleSubmit(J),className:"space-y-6",children:[e.jsxs(u,{children:[e.jsx(x,{children:e.jsx(p,{children:"Details"})}),e.jsxs(h,{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Customer *"}),e.jsxs(S,{value:t.watch("customer_id"),onValueChange:s=>t.setValue("customer_id",s),children:[e.jsx(v,{children:e.jsx(C,{placeholder:"Select Customer"})}),e.jsx(P,{children:k.map(s=>e.jsx(T,{value:s.id.toString(),children:s.name},s.id))})]}),t.formState.errors.customer_id&&e.jsx("p",{className:"text-sm text-red-500",children:t.formState.errors.customer_id.message})]}),e.jsxs("div",{className:"space-y-2 flex flex-col",children:[e.jsx(j,{children:"Date *"}),e.jsxs(V,{children:[e.jsx(F,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:w("w-full justify-start text-left font-normal",!t.watch("date")&&"text-muted-foreground"),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),t.watch("date")?b(t.watch("date"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(A,{className:"w-auto p-0",children:e.jsx(E,{mode:"single",selected:t.watch("date"),onSelect:s=>s&&t.setValue("date",s),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2 flex flex-col",children:[e.jsx(j,{children:"Due Date *"}),e.jsxs(V,{children:[e.jsx(F,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:w("w-full justify-start text-left font-normal",!t.watch("due_date")&&"text-muted-foreground"),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),t.watch("due_date")?b(t.watch("due_date"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(A,{className:"w-auto p-0",children:e.jsx(E,{mode:"single",selected:t.watch("due_date"),onSelect:s=>s&&t.setValue("due_date",s),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Reference"}),e.jsx(o,{...t.register("reference_number"),placeholder:"Auto-generated if empty"})]})]})]}),e.jsxs(u,{children:[e.jsx(x,{children:e.jsx(p,{children:"Items"})}),e.jsxs(h,{children:[e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(D,{children:[e.jsx(n,{className:"w-[30%]",children:"Product / Description"}),e.jsx(n,{className:"w-[15%]",children:"Qty"}),e.jsx(n,{className:"w-[20%]",children:"Price"}),e.jsx(n,{className:"w-[15%]",children:"Tax %"}),e.jsx(n,{className:"w-[15%] text-right",children:"Amount"}),e.jsx(n,{className:"w-[5%]"})]})}),e.jsx(re,{children:L.map((s,r)=>e.jsxs(D,{children:[e.jsxs(c,{className:"space-y-2",children:[e.jsxs(S,{value:t.watch(`items.${r}.product_id`)||void 0,onValueChange:a=>K(r,a),children:[e.jsx(v,{className:"h-8",children:e.jsx(C,{placeholder:"Select Product"})}),e.jsx(P,{children:g.map(a=>e.jsx(T,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(o,{...t.register(`items.${r}.description`),placeholder:"Description"}),t.formState.errors.items?.[r]?.description&&e.jsx("p",{className:"text-xs text-red-500",children:t.formState.errors.items[r]?.description?.message})]}),e.jsx(c,{children:e.jsx(o,{type:"number",step:"0.01",...t.register(`items.${r}.quantity`,{valueAsNumber:!0})})}),e.jsx(c,{children:e.jsx(o,{type:"number",step:"0.01",...t.register(`items.${r}.unit_price`,{valueAsNumber:!0})})}),e.jsx(c,{children:e.jsx(o,{type:"number",step:"0.01",...t.register(`items.${r}.tax_percent`,{valueAsNumber:!0})})}),e.jsx(c,{className:"text-right font-medium",children:f((_[r]?.quantity||0)*(_[r]?.unit_price||0))}),e.jsx(c,{children:e.jsx(l,{type:"button",variant:"ghost",size:"icon",onClick:()=>B(r),className:"text-red-500 hover:text-red-700",children:e.jsx(oe,{className:"h-4 w-4"})})})]},s.id))})]}),e.jsxs(l,{type:"button",variant:"outline",size:"sm",className:"mt-4",onClick:()=>M({description:"",quantity:1,unit_price:0,tax_percent:0,product_id:null}),children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," Create"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(u,{children:[e.jsx(x,{children:e.jsx(p,{children:"Notes"})}),e.jsx(h,{children:e.jsx(ee,{...t.register("notes"),placeholder:"Terms & Conditions, Payment details..."})})]}),e.jsxs(u,{children:[e.jsx(x,{children:e.jsx(p,{children:"Summary"})}),e.jsxs(h,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:f(z)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:f(Q)})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2 font-bold text-lg",children:[e.jsx("span",{children:"Amount"}),e.jsx("span",{children:f(G)})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(l,{variant:"outline",asChild:!0,children:e.jsx(X,{href:route("sales.invoices.index"),children:"Cancel"})}),e.jsx(l,{type:"submit",disabled:H,children:"Save Changes"})]})]})})]})}export{Je as default};
