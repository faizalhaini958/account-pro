import{r as u,j as e,H as ae,L as D,a as c}from"./app-De9YtYVO.js";import{A as te}from"./AdminLayout-B9Mfz47I.js";import{C as d,a as o,b as m,c as x}from"./card-B1noy23o.js";import{B as t}from"./index-sqIKGjOx.js";import{B as h}from"./badge-C9h6T3rK.js";import{T,a as k,b as g,c as l,d as A,e as r}from"./table-3xAxy9mO.js";import{D as L,b as R,c as P,d as E,e as H,f as I}from"./dialog-B_EPHwqc.js";import{S as V,a as F,b as M,c as Y,d as b}from"./select-B2rqhBdx.js";import{L as y}from"./label-BNYjQoyA.js";import{T as ie}from"./textarea-BrFMof27.js";import{A as ne}from"./arrow-left-BQixkFZB.js";import{S as le}from"./shield-CJZNipff.js";import{U as re}from"./user-cog-B_brAzyi.js";import{P as ce}from"./pencil-DxiAzbLY.js";import{U as de}from"./user-CJxw6ETj.js";import{C}from"./circle-check-DHnGCJry.js";import{C as oe}from"./clock-iIaGELyR.js";import{G as me}from"./globe-BnAvlmAt.js";import{C as G}from"./calendar-DaZVa6bq.js";import{B as O}from"./ban-BeVP-ciD.js";import{B as xe}from"./building-2-B8zwlaZI.js";import{C as w}from"./credit-card-wln7jJg5.js";import{T as he}from"./triangle-alert-CI0qCN5B.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./useTranslation-CmIvGiqX.js";import"./dropdown-menu-BBgrL1DT.js";import"./input-YJ4y34zb.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./ThemeToggle-IPjgC8LT.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./file-text-D4ZH2B6r.js";import"./index-CENxNQLL.js";function qe({user:s,plans:$}){const[z,p]=u.useState(!1),[N,S]=u.useState(""),[J,j]=u.useState(!1),[v,_]=u.useState(""),[B,Q]=u.useState("monthly"),i=a=>a?new Date(a).toLocaleDateString("en-MY",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",q=a=>new Intl.NumberFormat("en-MY",{style:"currency",currency:"MYR"}).format(a),f=a=>{const se={active:"default",inactive:"secondary",banned:"destructive",pending:"outline",completed:"default",failed:"destructive",cancelled:"secondary"};return e.jsx(h,{variant:se[a]||"outline",children:a})},K=()=>{c.post(route("admin.users.ban",s.id),{reason:N},{preserveScroll:!0,onSuccess:()=>{p(!1),S("")}})},W=()=>{c.post(route("admin.users.unban",s.id),{},{preserveScroll:!0})},U=()=>{c.post(route("admin.users.toggle",s.id),{},{preserveScroll:!0})},X=()=>{c.post(route("admin.users.subscription.assign",s.id),{plan_id:v,billing_cycle:B},{preserveScroll:!0,onSuccess:()=>{j(!1),_("")}})},Z=()=>{confirm("Are you sure you want to cancel this subscription?")&&c.delete(route("admin.users.subscription.cancel",s.id),{preserveScroll:!0})},ee=()=>{confirm(`Are you sure you want to login as ${s.name}?`)&&c.post(route("admin.users.impersonate",s.id))},n=s.subscriptions.find(a=>a.status==="active");return e.jsxs(te,{header:"User Details",children:[e.jsx(ae,{title:`User: ${s.name}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(t,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(D,{href:route("admin.users.index"),children:e.jsx(ne,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[s.name,s.is_super_admin&&e.jsxs(h,{variant:"secondary",children:[e.jsx(le,{className:"mr-1 h-3 w-3"}),"Super Admin"]})]}),e.jsx("p",{className:"text-muted-foreground",children:s.email})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!s.is_super_admin&&e.jsxs(t,{variant:"outline",onClick:ee,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Login as User"]}),e.jsx(t,{asChild:!0,children:e.jsxs(D,{href:route("admin.users.edit",s.id),children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Edit"]})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"User Information"]})}),e.jsxs(x,{children:[e.jsxs("dl",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx("dd",{className:"mt-1",children:f(s.status)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-muted-foreground",children:"Email Verified"}),e.jsx("dd",{className:"mt-1",children:s.email_verified_at?e.jsxs(h,{variant:"default",children:[e.jsx(C,{className:"mr-1 h-3 w-3"}),"Verified"]}):e.jsx(h,{variant:"outline",children:"Not Verified"})})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),"Last Login"]}),e.jsx("dd",{className:"mt-1 text-sm",children:i(s.last_login_at)})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3"}),"Last IP"]}),e.jsx("dd",{className:"mt-1 text-sm font-mono",children:s.last_login_ip||"-"})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),"Joined"]}),e.jsx("dd",{className:"mt-1 text-sm",children:i(s.created_at)})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),"Updated"]}),e.jsx("dd",{className:"mt-1 text-sm",children:i(s.updated_at)})]})]}),s.banned_at&&e.jsxs("div",{className:"mt-4 p-4 bg-destructive/10 rounded-lg border border-destructive/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-destructive font-medium",children:[e.jsx(O,{className:"h-4 w-4"}),"User is Banned"]}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Reason:"})," ",s.ban_reason]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Banned on ",i(s.banned_at)]})]}),s.admin_notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Admin Notes"}),e.jsx("p",{className:"text-sm bg-muted p-3 rounded-lg whitespace-pre-wrap",children:s.admin_notes})]})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Companies (",s.tenants.length,")"]})}),e.jsx(x,{children:s.tenants.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:"No companies created"}):e.jsxs(T,{children:[e.jsx(k,{children:e.jsxs(g,{children:[e.jsx(l,{children:"Company Name"}),e.jsx(l,{children:"Status"})]})}),e.jsx(A,{children:s.tenants.map(a=>e.jsxs(g,{children:[e.jsx(r,{className:"font-medium",children:a.name}),e.jsx(r,{children:e.jsx(h,{variant:a.is_active?"default":"secondary",children:a.is_active?"Active":"Inactive"})})]},a.id))})]})})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Recent Transactions"})}),e.jsx(x,{children:s.recent_transactions.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:"No transactions found"}):e.jsxs(T,{children:[e.jsx(k,{children:e.jsxs(g,{children:[e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Amount"}),e.jsx(l,{children:"Type"}),e.jsx(l,{children:"Gateway"}),e.jsx(l,{children:"Status"})]})}),e.jsx(A,{children:s.recent_transactions.map(a=>e.jsxs(g,{children:[e.jsx(r,{className:"text-sm",children:i(a.created_at)}),e.jsx(r,{className:"font-medium",children:q(a.amount)}),e.jsx(r,{children:e.jsx(h,{variant:"outline",children:a.type})}),e.jsx(r,{children:a.gateway_code}),e.jsx(r,{children:f(a.status)})]},a.id))})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"Subscription"]})}),e.jsx(x,{className:"space-y-4",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium text-lg",children:n.plan}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n.billing_cycle," billing"]}),e.jsx("div",{className:"mt-2",children:f(n.status)})]}),e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Started"}),e.jsx("dd",{children:i(n.starts_at)})]}),n.ends_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Expires"}),e.jsx("dd",{children:i(n.ends_at)})]})]}),e.jsx(t,{variant:"outline",className:"w-full",onClick:Z,children:"Cancel Subscription"})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(w,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"No active subscription"}),e.jsx(t,{onClick:()=>j(!0),className:"w-full",children:"Assign Subscription"})]})})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Quick Actions"})}),e.jsxs(x,{className:"space-y-2",children:[e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:()=>j(!0),children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),n?"Change Plan":"Assign Plan"]}),!s.is_super_admin&&e.jsxs(e.Fragment,{children:[s.status==="active"?e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:U,children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Disable User"]}):s.status==="inactive"?e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:U,children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Enable User"]}):null,s.status==="banned"?e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:W,children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Unban User"]}):e.jsxs(t,{variant:"destructive",className:"w-full justify-start",onClick:()=>p(!0),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Ban User"]})]})]})]}),s.subscriptions.length>1&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Subscription History"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:s.subscriptions.map(a=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.plan}),e.jsx("div",{className:"text-xs text-muted-foreground",children:i(a.starts_at)})]}),f(a.status)]},a.id))})})]})]})]})]}),e.jsx(L,{open:z,onOpenChange:p,children:e.jsxs(R,{children:[e.jsxs(P,{children:[e.jsx(E,{children:"Ban User"}),e.jsxs(H,{children:["This will prevent ",s.name," from accessing the system."]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"ban_reason",children:"Reason for ban"}),e.jsx(ie,{id:"ban_reason",value:N,onChange:a=>S(a.target.value),placeholder:"Enter the reason for banning this user...",rows:3})]})}),e.jsxs(I,{children:[e.jsx(t,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(t,{variant:"destructive",onClick:K,disabled:!N,children:"Ban User"})]})]})}),e.jsx(L,{open:J,onOpenChange:j,children:e.jsxs(R,{children:[e.jsxs(P,{children:[e.jsx(E,{children:"Assign Subscription"}),e.jsxs(H,{children:["Select a plan to assign to ",s.name]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Subscription Plan"}),e.jsxs(V,{value:v,onValueChange:_,children:[e.jsx(F,{children:e.jsx(M,{placeholder:"Select a plan"})}),e.jsx(Y,{children:$.map(a=>e.jsxs(b,{value:a.id.toString(),children:[a.name," - RM",a.price_monthly,"/mo"]},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Billing Cycle"}),e.jsxs(V,{value:B,onValueChange:Q,children:[e.jsx(F,{children:e.jsx(M,{})}),e.jsxs(Y,{children:[e.jsx(b,{value:"monthly",children:"Monthly"}),e.jsx(b,{value:"yearly",children:"Yearly"})]})]})]})]}),e.jsxs(I,{children:[e.jsx(t,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(t,{onClick:X,disabled:!v,children:"Assign Subscription"})]})]})})]})}export{qe as default};
