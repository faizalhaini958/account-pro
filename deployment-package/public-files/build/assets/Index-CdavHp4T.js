import{r as v,j as e,i as re,u as ie,H as le}from"./app-De9YtYVO.js";import{D as oe}from"./DashboardLayout-DB0kk3mn.js";import{D as ce}from"./data-table-D4pKVaNe.js";import{columns as ne}from"./columns-Xw7ANpHo.js";import{B as x,a as I}from"./index-sqIKGjOx.js";import{D as Q,b as U,c as X,d as G,e as J,f as K,a as de}from"./dialog-B_EPHwqc.js";import{I as d}from"./input-YJ4y34zb.js";import{L as c}from"./label-BNYjQoyA.js";import{T as P}from"./textarea-BrFMof27.js";import{S as k,a as M,b as L,c as H,d as q}from"./select-B2rqhBdx.js";import{P as E,a as z,b as A,C as B}from"./calendar-DDO4Otf0.js";import{T as me,a as ue,b as R,c as f,d as he,e as y}from"./table-3xAxy9mO.js";import{f as xe}from"./format-D9s8ZFBe.js";import{S as pe}from"./switch-EwwwBXc8.js";import{z as je}from"./toaster-CljvMPLZ.js";import{u as W}from"./useTranslation-CmIvGiqX.js";import{L as Y}from"./loader-circle-DjIWaf7f.js";import{C as V}from"./circle-plus-V1kVC-gi.js";import{C as O}from"./calendar-DaZVa6bq.js";import{T as ve}from"./trash-2-Dreerc3R.js";import{P as ge}from"./plus-DIUrj948.js";import{f as $}from"./format-BS8Ay9AX.js";import"./Combination-Dy-FKPUP.js";import"./dropdown-menu-BBgrL1DT.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./checkbox-DSt0QHsS.js";import"./index-CENxNQLL.js";import"./badge-C9h6T3rK.js";import"./arrow-up-down-1q5LzOz0.js";import"./ellipsis-yQlqSxW1.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./chevron-left-BEvpDX_2.js";function fe({open:T,onOpenChange:_,onSuccess:C}){const{t:s}=W(),{toast:N}=je(),[j,b]=v.useState(!1),[h,g]=v.useState({}),[o,i]=v.useState({name:"",code:"",email:"",phone:"",address:"",city:"",state:"",postal_code:"",country:"Malaysia",tax_identification_number:"",credit_limit:"",credit_days:"",is_active:!0}),r=(a,m)=>{i(p=>({...p,[a]:m})),h[a]&&g(p=>{const w={...p};return delete w[a],w})},F=async a=>{a.preventDefault(),b(!0),g({});try{const p=(await re.post(route("master.customers.store"),o,{headers:{Accept:"application/json","X-Inertia":""}})).data;N({title:s("common.success"),description:s("customers.createTitle")+" "+s("common.success")}),C(p),i({name:"",code:"",email:"",phone:"",address:"",city:"",state:"",postal_code:"",country:"Malaysia",tax_identification_number:"",credit_limit:"",credit_days:"",is_active:!0})}catch(m){m.response&&m.response.status===422?g(m.response.data.errors):(N({title:s("common.error"),description:s("common.error"),variant:"destructive"}),console.error(m))}finally{b(!1)}};return e.jsx(Q,{open:T,onOpenChange:_,children:e.jsxs(U,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(X,{children:[e.jsx(G,{children:s("customers.createTitle")}),e.jsx(J,{children:s("customers.createDesc")})]}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsxs(c,{htmlFor:"name",children:[s("customers.name")," *"]}),e.jsx(d,{id:"name",value:o.name,onChange:a=>r("name",a.target.value),required:!0}),h.name&&e.jsx("p",{className:"text-sm text-red-500",children:h.name[0]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"code",children:s("customers.code")}),e.jsx(d,{id:"code",value:o.code,onChange:a=>r("code",a.target.value),placeholder:s("customers.codePlaceholder")}),h.code&&e.jsx("p",{className:"text-sm text-red-500",children:h.code[0]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"tax_identification_number",children:s("customers.taxId")}),e.jsx(d,{id:"tax_identification_number",value:o.tax_identification_number,onChange:a=>r("tax_identification_number",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"email",children:s("customers.email")}),e.jsx(d,{id:"email",type:"email",value:o.email,onChange:a=>r("email",a.target.value)}),h.email&&e.jsx("p",{className:"text-sm text-red-500",children:h.email[0]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"phone",children:s("customers.phone")}),e.jsx(d,{id:"phone",value:o.phone,onChange:a=>r("phone",a.target.value)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(c,{htmlFor:"address",children:s("customers.address")}),e.jsx(P,{id:"address",value:o.address,onChange:a=>r("address",a.target.value),rows:2})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"city",children:s("customers.city")}),e.jsx(d,{id:"city",value:o.city,onChange:a=>r("city",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"postal_code",children:s("customers.postalCode")}),e.jsx(d,{id:"postal_code",value:o.postal_code,onChange:a=>r("postal_code",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"state",children:s("customers.state")}),e.jsx(d,{id:"state",value:o.state,onChange:a=>r("state",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"country",children:s("customers.country")}),e.jsx(d,{id:"country",value:o.country,onChange:a=>r("country",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"credit_limit",children:s("customers.creditLimit")}),e.jsx(d,{id:"credit_limit",type:"number",value:o.credit_limit,onChange:a=>r("credit_limit",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"credit_days",children:s("customers.creditDays")}),e.jsx(d,{id:"credit_days",type:"number",value:o.credit_days,onChange:a=>r("credit_days",a.target.value)})]}),e.jsxs("div",{className:"col-span-2 flex items-center space-x-2",children:[e.jsx(pe,{id:"is_active",checked:o.is_active,onCheckedChange:a=>r("is_active",a)}),e.jsx(c,{htmlFor:"is_active",children:s("master.isActiveStatus")})]})]})}),e.jsxs(K,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>_(!1),children:s("master.cancel")}),e.jsxs(x,{type:"submit",disabled:j,children:[j&&e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),s("customers.createTitle")]})]})]})]})})}function ls({quotations:T,customers:_,products:C}){const{t:s}=W(),[N,j]=v.useState(!1),[b,h]=v.useState(_),[g,o]=v.useState(!1),{data:i,setData:r,post:F,processing:a,errors:m,reset:p}=ie({customer_id:"",date:new Date,valid_until:void 0,notes:"",terms:"",items:[{product_id:"",description:"",quantity:1,unit_price:0}]}),w=()=>{r("items",[...i.items,{product_id:"",description:"",quantity:1,unit_price:0}])},Z=t=>{if(i.items.length<=1)return;const n=i.items.filter((l,u)=>u!==t);r("items",n)},S=(t,n,l)=>{const u=[...i.items];if(n==="product_id"){const D=C.find(ae=>ae.id.toString()===l);D?u[t]={...u[t],product_id:l,description:D.name,unit_price:parseFloat(D.retail_price)||0}:u[t]={...u[t],[n]:l}}else u[t]={...u[t],[n]:l};r("items",u)},ee=()=>i.items.reduce((t,n)=>{const l=n.quantity||0,u=n.unit_price||0;return t+l*u},0),se=t=>{t.preventDefault(),F(route("sales.quotations.store"),{onSuccess:()=>{j(!1),p()}})},te=t=>{h(n=>[...n,t]),r("customer_id",t.id.toString()),o(!1)};return e.jsxs(oe,{header:s("quotations.title"),children:[e.jsx(le,{title:s("quotations.title")}),e.jsx(fe,{open:g,onOpenChange:o,onSuccess:te}),e.jsxs("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:s("quotations.title")}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(Q,{open:N,onOpenChange:j,children:[e.jsx(de,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),s("quotations.create")]})}),e.jsxs(U,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(X,{children:[e.jsx(G,{children:s("quotations.create")}),e.jsx(J,{children:s("quotations.new")})]}),e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-1 lg:col-span-2 space-y-2",children:[e.jsx(c,{htmlFor:"customer_id",children:s("sales.customer")}),e.jsxs(k,{value:i.customer_id,onValueChange:t=>{t==="_new_"?o(!0):r("customer_id",t)},children:[e.jsx(M,{children:e.jsx(L,{placeholder:s("user.selectCompany")})}),e.jsxs(H,{children:[e.jsx(q,{value:"_new_",className:"text-primary font-medium bg-primary/10 hover:bg-primary/20 cursor-pointer",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),s("customers.new")]})}),b?.map(t=>e.jsxs(q,{value:t.id.toString(),children:[t.name," ",t.company_name?`(${t.company_name})`:""]},t.id))]})]}),m.customer_id&&e.jsx("p",{className:"text-sm text-red-500",children:m.customer_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:s("sales.date")}),e.jsxs(E,{children:[e.jsx(z,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:I("w-full pl-3 text-left font-normal",!i.date&&"text-muted-foreground"),children:[i.date?$(i.date,"dd/MM/yyyy"):e.jsx("span",{children:"Pick a date"}),e.jsx(O,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(A,{className:"w-auto p-0",align:"start",children:e.jsx(B,{mode:"single",selected:i.date,onSelect:t=>t&&r("date",t),initialFocus:!0})})]}),m.date&&e.jsx("p",{className:"text-sm text-red-500",children:m.date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:s("quotations.validUntil")}),e.jsxs(E,{children:[e.jsx(z,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:I("w-full pl-3 text-left font-normal",!i.valid_until&&"text-muted-foreground"),children:[i.valid_until?$(i.valid_until,"dd/MM/yyyy"):e.jsx("span",{children:"Pick a date"}),e.jsx(O,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(A,{className:"w-auto p-0",align:"start",children:e.jsx(B,{mode:"single",selected:i.valid_until,onSelect:t=>r("valid_until",t),initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"border rounded-md p-4 bg-muted/20",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-medium",children:s("quotations.items")})}),e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(R,{children:[e.jsx(f,{className:"w-[30%]",children:s("products.name")}),e.jsx(f,{className:"w-[25%]",children:s("products.description")}),e.jsx(f,{className:"w-[15%]",children:"Qty"}),e.jsx(f,{className:"w-[20%]",children:s("products.retailPrice")}),e.jsx(f,{className:"w-[10%]"})]})}),e.jsx(he,{children:i.items.map((t,n)=>e.jsxs(R,{children:[e.jsx(y,{children:e.jsxs(k,{value:t.product_id,onValueChange:l=>S(n,"product_id",l),children:[e.jsx(M,{children:e.jsx(L,{placeholder:s("common.search")})}),e.jsx(H,{children:C?.map(l=>e.jsx(q,{value:l.id.toString(),children:l.sku},l.id))})]})}),e.jsx(y,{children:e.jsx(d,{value:t.description,onChange:l=>S(n,"description",l.target.value)})}),e.jsx(y,{children:e.jsx(d,{type:"number",min:"1",step:"1",value:t.quantity,onChange:l=>S(n,"quantity",parseFloat(l.target.value)||0)})}),e.jsx(y,{children:e.jsx(d,{type:"number",min:"0",step:"0.01",value:t.unit_price,onChange:l=>S(n,"unit_price",parseFloat(l.target.value)||0)})}),e.jsx(y,{children:e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>Z(n),children:e.jsx(ve,{className:"h-4 w-4 text-red-500"})})})]},n))})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:w,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," ",s("common.create")]}),e.jsxs("div",{className:"text-lg font-bold",children:["Total: ",xe(ee())]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"notes",children:"Notes"}),e.jsx(P,{id:"notes",value:i.notes,onChange:t=>r("notes",t.target.value),placeholder:"Notes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"terms",children:"Terms"}),e.jsx(P,{id:"terms",value:i.terms,onChange:t=>r("terms",t.target.value),placeholder:"Terms..."})]})]}),e.jsxs(K,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>j(!1),children:s("common.cancel")}),e.jsxs(x,{type:"submit",disabled:a,children:[a&&e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),s("quotations.create")]})]})]})]})]})})]}),e.jsx("div",{className:"hidden h-full flex-1 flex-col space-y-8 md:flex",children:e.jsx(ce,{columns:ne,data:T.data})})]})]})}export{ls as default};
