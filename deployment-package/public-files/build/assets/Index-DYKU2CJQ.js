import{r as u,u as E,j as e,H as J}from"./app-De9YtYVO.js";import{D as F}from"./DashboardLayout-DB0kk3mn.js";import{B as d}from"./index-sqIKGjOx.js";import{T as H,a as I,b,c as o,d as M,e as m}from"./table-3xAxy9mO.js";import{f as j}from"./format-D9s8ZFBe.js";import{D as k,a as A,b as B,c as O,d as P,e as R,f as q}from"./dialog-B_EPHwqc.js";import{I as c}from"./input-YJ4y34zb.js";import{L as f}from"./label-BNYjQoyA.js";import{S as z,a as V,b as $,c as G,d as K}from"./select-B2rqhBdx.js";import{columns as Q}from"./columns-D8GWlsSq.js";import{D as U}from"./data-table-D4pKVaNe.js";import{P as v}from"./plus-DIUrj948.js";import{T as W}from"./trash-2-Dreerc3R.js";import{L as X}from"./loader-circle-DjIWaf7f.js";import"./toaster-CljvMPLZ.js";import"./Combination-Dy-FKPUP.js";import"./useTranslation-CmIvGiqX.js";import"./dropdown-menu-BBgrL1DT.js";import"./index-DEhQiHRI.js";import"./x-D7kv7_oa.js";import"./file-text-D4ZH2B6r.js";import"./building-2-B8zwlaZI.js";import"./users-Cw2EaZtR.js";import"./package-DX_4eLNa.js";import"./LanguageSwitcher-JaZwuRsp.js";import"./globe-BnAvlmAt.js";import"./ThemeToggle-IPjgC8LT.js";import"./circle-alert-nT1vmDMj.js";import"./index-CENxNQLL.js";import"./badge-C9h6T3rK.js";import"./checkbox-DSt0QHsS.js";import"./arrow-up-down-1q5LzOz0.js";import"./eye-BecJcslc.js";import"./format-BS8Ay9AX.js";function Fe({entries:N,accounts:y}){const[D,p]=u.useState(!1),{data:i,setData:n,post:C,processing:g,errors:x,reset:w}=E({date:new Date().toISOString().split("T")[0],description:"",reference_number:"",lines:[{account_id:"",description:"",debit:0,credit:0},{account_id:"",description:"",debit:0,credit:0}]}),[l,T]=u.useState({debit:0,credit:0,diff:0});u.useEffect(()=>{const s=i.lines.reduce((t,a)=>t+(a.debit||0),0),r=i.lines.reduce((t,a)=>t+(a.credit||0),0);T({debit:s,credit:r,diff:s-r})},[i.lines]);const h=(s,r,t)=>{const a=[...i.lines];a[s]={...a[s],[r]:t},r==="debit"&&t>0&&(a[s].credit=0),r==="credit"&&t>0&&(a[s].debit=0),n("lines",a)},S=()=>{n("lines",[...i.lines,{account_id:"",description:"",debit:0,credit:0}])},L=s=>{if(i.lines.length<=2)return;const r=i.lines.filter((t,a)=>a!==s);n("lines",r)},_=s=>{if(s.preventDefault(),Math.abs(l.diff)>.01){alert("Journal must balance (Difference must be 0) before posting.");return}C(route("accounting.journals.store"),{onSuccess:()=>{p(!1),w(),n("lines",[{account_id:"",description:"",debit:0,credit:0},{account_id:"",description:"",debit:0,credit:0}])}})};return e.jsxs(F,{header:"Journal Entries",children:[e.jsx(J,{title:"Journal Entries"}),e.jsxs("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Journal Entries"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage manual and system-generated journal entries."})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(k,{open:D,onOpenChange:p,children:[e.jsx(A,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(v,{className:"mr-2 h-4 w-4"})," New Journal Entry"]})}),e.jsxs(B,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(O,{children:[e.jsx(P,{children:"New Journal Entry"}),e.jsx(R,{children:"Create a manual journal entry. Debits must equal Credits."})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"date",children:"Date *"}),e.jsx(c,{id:"date",type:"date",value:i.date,onChange:s=>n("date",s.target.value),required:!0}),x.date&&e.jsx("p",{className:"text-sm text-red-500",children:x.date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"reference",children:"Reference #"}),e.jsx(c,{id:"reference",value:i.reference_number,onChange:s=>n("reference_number",s.target.value),placeholder:"e.g. ADJ-001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"description",children:"Description"}),e.jsx(c,{id:"description",value:i.description,onChange:s=>n("description",s.target.value),placeholder:"Brief description"})]})]}),e.jsxs("div",{className:"border rounded-md p-4 space-y-4",children:[e.jsxs(H,{children:[e.jsx(I,{children:e.jsxs(b,{children:[e.jsx(o,{className:"w-[30%]",children:"Account"}),e.jsx(o,{className:"w-[30%]",children:"Description"}),e.jsx(o,{className:"w-[15%] text-right",children:"Debit"}),e.jsx(o,{className:"w-[15%] text-right",children:"Credit"}),e.jsx(o,{className:"w-[5%]"})]})}),e.jsx(M,{children:i.lines.map((s,r)=>e.jsxs(b,{children:[e.jsx(m,{children:e.jsxs(z,{value:s.account_id,onValueChange:t=>h(r,"account_id",t),children:[e.jsx(V,{children:e.jsx($,{placeholder:"Select Account"})}),e.jsx(G,{children:y?.map(t=>e.jsxs(K,{value:t.id.toString(),children:[t.code," - ",t.name]},t.id))})]})}),e.jsx(m,{children:e.jsx(c,{value:s.description,onChange:t=>h(r,"description",t.target.value),placeholder:"Line description"})}),e.jsx(m,{children:e.jsx(c,{type:"number",min:"0",step:"0.01",value:s.debit,onChange:t=>h(r,"debit",parseFloat(t.target.value)||0),className:"text-right"})}),e.jsx(m,{children:e.jsx(c,{type:"number",min:"0",step:"0.01",value:s.credit,onChange:t=>h(r,"credit",parseFloat(t.target.value)||0),className:"text-right"})}),e.jsx(m,{children:i.lines.length>2&&e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>L(r),className:"text-red-500",children:e.jsx(W,{className:"h-4 w-4"})})})]},r))})]}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:S,children:[e.jsx(v,{className:"mr-2 h-4 w-4"})," Add Line"]}),e.jsxs("div",{className:"flex justify-end gap-8 pt-4 border-t text-sm font-medium",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-muted-foreground",children:"Total Debit"}),e.jsx("div",{className:"text-xl",children:j(l.debit)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-muted-foreground",children:"Total Credit"}),e.jsx("div",{className:"text-xl",children:j(l.credit)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-muted-foreground",children:"Difference"}),e.jsx("div",{className:`text-xl ${Math.abs(l.diff)>.01?"text-red-600":"text-green-600"}`,children:j(Math.abs(l.diff))})]})]})]}),x.lines&&e.jsx("p",{className:"text-sm text-red-500 text-right",children:x.lines}),e.jsxs(q,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(d,{type:"submit",disabled:g||Math.abs(l.diff)>.01,children:[g&&e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}),"Post Journal Entry"]})]})]})]})]})})]}),e.jsx("div",{className:"hidden h-full flex-1 flex-col space-y-8 md:flex",children:e.jsx(U,{columns:Q,data:N.data})})]})]})}export{Fe as default};
